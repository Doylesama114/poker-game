# å¡ç‰Œæ¸¸æˆé¡¹ç›®å®Œæ•´æ–‡æ¡£

> **ğŸ“Œ æœ€æ–°æ›´æ–°**ï¼š2026å¹´2æœˆ12æ—¥  
> **å½“å‰çŠ¶æ€**ï¼šäº’è”ç½‘è”æœºéƒ¨ç½²å®Œæˆï¼ˆGitHub Pages + ngrokï¼‰  
> **å·²å®Œæˆ**ï¼šæƒå¨æœåŠ¡å™¨æ¶æ„ã€GitHub Pages éƒ¨ç½²ã€ngrok é…ç½®

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
3. [æ ¸å¿ƒåŠŸèƒ½](#æ ¸å¿ƒåŠŸèƒ½)
4. [æ¸¸æˆè§„åˆ™](#æ¸¸æˆè§„åˆ™)
5. [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)
6. [å¼€å‘å†å²](#å¼€å‘å†å²)
7. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
8. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäº Vue 3 + TypeScript çš„å›åˆåˆ¶å¡ç‰Œå¯¹æˆ˜æ¸¸æˆï¼Œæ”¯æŒå•æœºAIå¯¹æˆ˜å’Œè”æœºå¯¹æˆ˜ã€‚

### æŠ€æœ¯æ ˆ

- **å‰ç«¯**: Vue 3, TypeScript, Vite, UnoCSS
- **åç«¯**: Node.js, Express, Socket.IO
- **éƒ¨ç½²**: GitHub Pages (å‰ç«¯), ngrok (åç«¯ä¸´æ—¶)
- **çŠ¶æ€ç®¡ç†**: Vue Composition API
- **å®æ—¶é€šä¿¡**: WebSocket (Socket.IO)
- **æ¶æ„**: æƒå¨æœåŠ¡å™¨ï¼ˆAuthoritative Serverï¼‰

### æ¸¸æˆç‰¹è‰²

- 15å¼ ç‹¬ç‰¹å¡ç‰Œï¼Œæ¯å¼ åªæœ‰1ä»½
- å¤æ‚çš„å¡ç‰Œæ•ˆæœç³»ç»Ÿï¼ˆéƒ¨ç½²æ•ˆæœã€æŒç»­æ•ˆæœã€å åŠ æ•ˆæœï¼‰
- æ§½ä½é€‰æ‹©æœºåˆ¶
- ç›®æ ‡é€‰æ‹©ç³»ç»Ÿ
- é‡é“¸ç³»ç»Ÿï¼ˆæ¯å›åˆå¯é€‰æ‹©å‡ºç‰Œæˆ–é‡é“¸ï¼‰
- æ”¯æŒ2äººè”æœºå¯¹æˆ˜
- æ”¯æŒå†…ç½‘ç©¿é€ï¼ˆSakura FRPï¼‰

---

## æŠ€æœ¯æ¶æ„

### å‰ç«¯æ¶æ„

```
src/
â”œâ”€â”€ composables/          # ç»„åˆå¼å‡½æ•°
â”‚   â”œâ”€â”€ useGame.ts       # å•æœºæ¸¸æˆé€»è¾‘ï¼ˆåŸºç¡€ç‰ˆï¼‰
â”‚   â”œâ”€â”€ useGameNew.ts    # å•æœºæ¸¸æˆé€»è¾‘ï¼ˆå®Œæ•´ç‰ˆï¼‰
â”‚   â”œâ”€â”€ useGameMultiplayer.ts  # è”æœºæ¸¸æˆé€»è¾‘
â”‚   â””â”€â”€ useMultiplayer.ts      # è”æœºè¿æ¥ç®¡ç†
â”œâ”€â”€ views/
â”‚   â””â”€â”€ Game/
â”‚       â”œâ”€â”€ Home.vue                    # ä¸»é¡µ
â”‚       â”œâ”€â”€ CardGame.vue                # å•æœºæ¸¸æˆï¼ˆåŸºç¡€ç‰ˆï¼‰
â”‚       â”œâ”€â”€ CardGameNew.vue             # å•æœºæ¸¸æˆï¼ˆå®Œæ•´ç‰ˆï¼‰
â”‚       â”œâ”€â”€ MultiplayerLobby.vue        # è”æœºå¤§å…
â”‚       â”œâ”€â”€ CardGameMultiplayer.vue     # è”æœºæ¸¸æˆ
â”‚       â””â”€â”€ ServerConfigDialog.vue      # æœåŠ¡å™¨é…ç½®
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ cards.ts          # å¡ç‰Œæ•°æ®å’Œç‰Œç»„åˆ›å»º
â”‚   â””â”€â”€ cardDatabase.ts   # å¡ç‰Œæ•°æ®åº“
â”œâ”€â”€ game/
â”‚   â””â”€â”€ effectManager.ts  # æ•ˆæœç®¡ç†å™¨
â”œâ”€â”€ types/
â”‚   â””â”€â”€ game.ts          # ç±»å‹å®šä¹‰
â””â”€â”€ config/
    â””â”€â”€ multiplayer.ts   # è”æœºé…ç½®
```

### åç«¯æ¶æ„

```
server/
â”œâ”€â”€ index.js             # Socket.IO æœåŠ¡å™¨
â””â”€â”€ package.json         # ä¾èµ–é…ç½®
```

### æ ¸å¿ƒæ¨¡å—è¯´æ˜

#### 1. æ¸¸æˆé€»è¾‘å±‚ (useGameMultiplayer.ts)

- **èŒè´£**: ç®¡ç†æ¸¸æˆçŠ¶æ€ã€å›åˆæµç¨‹ã€å¡ç‰Œæ•ˆæœ
- **å…³é”®åŠŸèƒ½**:
  - åˆå§‹åŒ–æ¸¸æˆï¼ˆç‰Œç»„ã€æ‰‹ç‰Œã€åœºåœ°ï¼‰
  - å›åˆç®¡ç†ï¼ˆæŠ½ç‰Œã€å†³ç­–ã€è¡ŒåŠ¨ï¼‰
  - å¡ç‰Œéƒ¨ç½²å’Œæ•ˆæœè§¦å‘
  - æˆ˜åŠ›è®¡ç®—
  - æ¸¸æˆç»“æŸåˆ¤å®š

#### 2. è”æœºç®¡ç†å±‚ (useMultiplayer.ts)

- **èŒè´£**: ç®¡ç† WebSocket è¿æ¥ã€æˆ¿é—´ã€æ¶ˆæ¯åŒæ­¥
- **å…³é”®åŠŸèƒ½**:
  - Socket.IO è¿æ¥ç®¡ç†
  - æˆ¿é—´åˆ›å»º/åŠ å…¥
  - æ“ä½œåŒæ­¥ï¼ˆå‘é€/æ¥æ”¶ï¼‰
  - æ–­çº¿é‡è¿
  - æ ‡ç­¾é¡µéš”ç¦»ï¼ˆsessionStorageï¼‰

#### 3. æ•ˆæœç®¡ç†å™¨ (effectManager.ts)

- **èŒè´£**: å¤„ç†å¡ç‰Œæ•ˆæœçš„è§¦å‘å’Œè®¡ç®—
- **å…³é”®åŠŸèƒ½**:
  - éƒ¨ç½²æ•ˆæœè§¦å‘
  - æŒç»­æ•ˆæœè®¡ç®—
  - ç›®æ ‡ç­›é€‰
  - æˆ˜åŠ›é‡ç®—
  - å åŠ æ•ˆæœç®¡ç†

#### 4. å¡ç‰Œæ•°æ®åº“ (cardDatabase.ts)

- **èŒè´£**: å­˜å‚¨å’Œæ£€ç´¢å¡ç‰Œæ•°æ®
- **å…³é”®åŠŸèƒ½**:
  - å¡ç‰Œæ³¨å†Œ
  - å¡ç‰Œå…‹éš†
  - ID/åç§°æŸ¥è¯¢

---

## æ ¸å¿ƒåŠŸèƒ½

### 1. å¡ç‰Œç³»ç»Ÿ

#### å¡ç‰Œç±»å‹
- **å•ä½å¡ (unit)**: æœ‰æˆ˜åŠ›ï¼Œå¯æŒç»­åœ¨åœº
- **ç¯å¢ƒå¡ (environment)**: æŒç»­æ•ˆæœï¼Œå½±å“åœºä¸Šå…¶ä»–å¡ç‰Œ
- **æˆ˜æœ¯å¡ (tactic)**: å³æ—¶æ•ˆæœï¼Œä½¿ç”¨åå¼ƒç½®

#### å¡ç‰Œå±æ€§
- **ID**: å”¯ä¸€æ ‡è¯†ç¬¦
- **åç§°**: å¡ç‰Œåç§°
- **ç±»å‹**: unit/environment/tactic
- **å…³é”®è¯**: ç”¨äºæ•ˆæœç­›é€‰ï¼ˆå¦‚"å±…æ°‘"ã€"æ­¦å™¨"ï¼‰
- **å±æ€§**: åœŸ/é’¢/æœ¨/ç«/é£/æ°´/å¥¥æœ¯/æ— 
- **åŸºç¡€æˆ˜åŠ›**: åˆå§‹æˆ˜åŠ›å€¼
- **å½“å‰æˆ˜åŠ›**: å—æ•ˆæœå½±å“åçš„æˆ˜åŠ›
- **è´¹ç”¨**: æ‰“å‡ºæ‰€éœ€è´¹ç”¨
- **æ•ˆæœ**: æ•ˆæœåˆ—è¡¨

#### æ•ˆæœç³»ç»Ÿ

**æ•ˆæœæ—¶æœº**:
- `onDeploy`: éƒ¨ç½²æ—¶è§¦å‘
- `onField`: åœ¨åœºæŒç»­ç”Ÿæ•ˆ
- `onReveal`: æ­ç¤ºæ—¶ï¼ˆæˆ˜æœ¯ç‰Œï¼‰
- `onOtherPlay`: å…¶ä»–å¡ç‰Œæ‰“å‡ºæ—¶è§¦å‘

**æ•ˆæœç±»å‹**:
- `extraPlay`: é¢å¤–å‡ºç‰Œ
- `modifyPower`: ä¿®æ”¹æˆ˜åŠ›
- `modifyCost`: ä¿®æ”¹è´¹ç”¨
- `createSlot`: åˆ›å»ºé¢å¤–æ§½ä½
- `conditional`: æ¡ä»¶æ•ˆæœ

**å åŠ æ•ˆæœ**:
æŸäº›å¡ç‰Œï¼ˆå¦‚æ³•å¸ˆã€æˆ˜å£«ï¼‰çš„æ•ˆæœå¯ä»¥å åŠ ï¼Œä½¿ç”¨ `stackedBonus` å­—æ®µæŒä¹…åŒ–ã€‚

### 2. æ¸¸æˆæµç¨‹

#### å›åˆé˜¶æ®µ
1. **æŠ½ç‰Œé˜¶æ®µ (draw)**: ä»ç‰Œç»„æŠ½1å¼ ç‰Œ
2. **å†³ç­–é˜¶æ®µ (decision)**: é€‰æ‹©"å‡ºç‰Œ"æˆ–"é‡é“¸"
3. **è¡ŒåŠ¨é˜¶æ®µ (action)**: 
   - å‡ºç‰Œ: é€‰æ‹©æ‰‹ç‰Œ â†’ é€‰æ‹©æ§½ä½ â†’ éƒ¨ç½²
   - é‡é“¸: é€‰æ‹©2ä¸ªæ“ä½œï¼ˆæ¢å¤è´¹ç”¨/æ¢ç‰Œ/æˆ˜åŠ›+1ï¼‰
4. **ç­‰å¾…é˜¶æ®µ**: ç­‰å¾…å¯¹æ‰‹å®Œæˆæ“ä½œ
5. **ä¸‹ä¸€å›åˆ**: åŒæ–¹éƒ½å®Œæˆåè¿›å…¥ä¸‹ä¸€å›åˆ

#### æ¸¸æˆç»“æŸæ¡ä»¶
- ä»»ä¸€ç©å®¶å¡«æ»¡6ä¸ªä¸»æ§½ä½ â†’ è§¦å‘æœ€åä¸€å›åˆ
- å¯¹æ‰‹å†è¿›è¡Œä¸€ä¸ªå®Œæ•´å›åˆ
- ç»“ç®—æ€»æˆ˜åŠ›ï¼Œé«˜è€…è·èƒœ

### 3. è”æœºç³»ç»Ÿ

#### è¿æ¥æµç¨‹
1. å®¢æˆ·ç«¯è¿æ¥åˆ° Socket.IO æœåŠ¡å™¨
2. åˆ›å»ºæˆ¿é—´æˆ–åŠ å…¥æˆ¿é—´
3. æˆ¿é—´æ»¡å‘˜ï¼ˆ2äººï¼‰åè‡ªåŠ¨å¼€å§‹æ¸¸æˆ
4. æ¸¸æˆè¿‡ç¨‹ä¸­å®æ—¶åŒæ­¥æ“ä½œ

#### æ“ä½œåŒæ­¥
æ‰€æœ‰æ¸¸æˆæ“ä½œé€šè¿‡ `GameAction` åŒæ­¥ï¼š
- `choosePlay`: é€‰æ‹©å‡ºç‰Œ
- `chooseReforge`: é€‰æ‹©é‡é“¸
- `playCard`: æ‰“å‡ºå¡ç‰Œ
- `executeReforge`: æ‰§è¡Œé‡é“¸
- `skipTurn`: è·³è¿‡å›åˆ
- `finalRound`: æœ€åä¸€å›åˆé€šçŸ¥

#### æˆ¿é—´ç®¡ç†
- æˆ¿é—´çŠ¶æ€: `waiting` / `playing` / `finished`
- æ–­çº¿ä¿æŠ¤: æ¸¸æˆä¸­çš„æˆ¿é—´ä¿ç•™30ç§’
- é‡æ–°åŠ å…¥: ä½¿ç”¨ sessionStorage æ¢å¤æˆ¿é—´ä¿¡æ¯

---

## æ–‡ä»¶ç»“æ„

### å…³é”®æ–‡ä»¶è¯´æ˜

#### å‰ç«¯æ ¸å¿ƒæ–‡ä»¶

**src/composables/useGameMultiplayer.ts**
- è”æœºæ¸¸æˆçš„æ ¸å¿ƒé€»è¾‘
- ç®¡ç†æ¸¸æˆçŠ¶æ€ã€ç©å®¶ä¿¡æ¯ã€å›åˆæµç¨‹
- å¤„ç†å¯¹æ‰‹æ“ä½œçš„åº”ç”¨
- å…³é”®å‡½æ•°:
  - `initGame()`: åˆå§‹åŒ–æ¸¸æˆ
  - `applyOpponentAction()`: åº”ç”¨å¯¹æ‰‹æ“ä½œ
  - `checkFieldFull()`: æ£€æŸ¥åœºåœ°æ˜¯å¦å¡«æ»¡
  - `deployCard()`: éƒ¨ç½²å¡ç‰Œ
  - `endGame()`: ç»“æŸæ¸¸æˆ

**src/composables/useMultiplayer.ts**
- WebSocket è¿æ¥ç®¡ç†
- æˆ¿é—´æ“ä½œï¼ˆåˆ›å»º/åŠ å…¥/ç¦»å¼€ï¼‰
- æ¶ˆæ¯å‘é€å’Œæ¥æ”¶
- æ ‡ç­¾é¡µéš”ç¦»ï¼ˆæ¯ä¸ªæ ‡ç­¾é¡µç‹¬ç«‹çš„ socket å®ä¾‹ï¼‰
- å…³é”®å‡½æ•°:
  - `connect()`: è¿æ¥æœåŠ¡å™¨
  - `createRoom()`: åˆ›å»ºæˆ¿é—´
  - `joinRoom()`: åŠ å…¥æˆ¿é—´
  - `sendAction()`: å‘é€æ“ä½œ
  - `onOpponentAction()`: ç›‘å¬å¯¹æ‰‹æ“ä½œ

**src/views/Game/CardGameMultiplayer.vue**
- è”æœºæ¸¸æˆç•Œé¢
- æ˜¾ç¤ºåŒæ–¹åœºåœ°ã€æ‰‹ç‰Œã€æˆ˜åŠ›
- å¤„ç†ç”¨æˆ·äº¤äº’
- ç®¡ç†å›åˆåŒæ­¥ï¼ˆready çŠ¶æ€ï¼‰

**src/game/effectManager.ts**
- æ•ˆæœè§¦å‘å’Œè®¡ç®—
- ç›®æ ‡ç­›é€‰
- æˆ˜åŠ›é‡ç®—
- å åŠ æ•ˆæœç®¡ç†

**src/data/cardDatabase.ts**
- å¡ç‰Œæ•°æ®å­˜å‚¨
- å¡ç‰ŒæŸ¥è¯¢å’Œå…‹éš†
- å•ä¾‹æ¨¡å¼

#### åç«¯æ ¸å¿ƒæ–‡ä»¶

**server/index.js**
- Socket.IO æœåŠ¡å™¨
- æˆ¿é—´ç®¡ç†
- æ“ä½œå¹¿æ’­
- æ–­çº¿å¤„ç†

---

## æ¸¸æˆè§„åˆ™

### åŸºç¡€è§„åˆ™

1. **ç‰Œç»„**: 15å¼ å¡ç‰Œï¼Œæ¯å¼ åªæœ‰1ä»½
2. **èµ·å§‹æ‰‹ç‰Œ**: 3å¼ 
3. **èµ·å§‹è´¹ç”¨**: 4ç‚¹
4. **åœºåœ°**: 6ä¸ªä¸»æ§½ä½ + å¯èƒ½çš„é¢å¤–æ§½ä½
5. **å›åˆ**: åŒæ—¶è¿›è¡Œï¼ˆåŒæ–¹åŒæ—¶æ“ä½œï¼‰

### å›åˆæµç¨‹

æ¯å›åˆï¼š
1. æŠ½1å¼ ç‰Œï¼ˆå¦‚æœç‰Œç»„ä¸ä¸ºç©ºï¼‰
2. é€‰æ‹©"å‡ºç‰Œ"æˆ–"é‡é“¸"
3. æ‰§è¡Œæ“ä½œ
4. ç­‰å¾…å¯¹æ‰‹å®Œæˆ
5. åŒæ–¹éƒ½å®Œæˆåè¿›å…¥ä¸‹ä¸€å›åˆ

### å‡ºç‰Œè§„åˆ™

- é€‰æ‹©æ‰‹ç‰Œ â†’ é€‰æ‹©ç©ºæ§½ä½ â†’ æ”¯ä»˜è´¹ç”¨ â†’ éƒ¨ç½²
- æŸäº›å¡ç‰Œå…è®¸é¢å¤–å‡ºç‰Œï¼ˆå¦‚"è¾›å‹¤çš„è‹¦å·¥"ï¼‰
- è´¹ç”¨ä¸è¶³æ—¶æ— æ³•å‡ºç‰Œï¼Œå¯é€‰æ‹©è·³è¿‡

### é‡é“¸è§„åˆ™

é€‰æ‹©2ä¸ªæ“ä½œï¼ˆå¯é‡å¤ï¼‰ï¼š
- **æ¢å¤è´¹ç”¨**: +2è´¹ç”¨
- **æ¢ç‰Œ**: å°†1å¼ æ‰‹ç‰Œæ”¾å›ç‰Œç»„é¡¶ï¼ŒæŠ½1å¼ æ–°ç‰Œ
- **æˆ˜åŠ›+1**: æ€»æˆ˜åŠ›æ°¸ä¹…+1

### èƒœåˆ©æ¡ä»¶

- ä»»ä¸€ç©å®¶å¡«æ»¡6ä¸ªä¸»æ§½ä½ â†’ æœ€åä¸€å›åˆ
- å¯¹æ‰‹å†è¿›è¡Œä¸€ä¸ªå®Œæ•´å›åˆ
- æ¯”è¾ƒæ€»æˆ˜åŠ›ï¼ˆåœºä¸Šæ‰€æœ‰å•ä½æˆ˜åŠ› + å¥–åŠ±æˆ˜åŠ›ï¼‰
- æˆ˜åŠ›é«˜è€…è·èƒœï¼Œç›¸åŒåˆ™å¹³å±€

---

## è”æœºç³»ç»Ÿ

### æœåŠ¡å™¨é…ç½®

#### æœ¬åœ°æµ‹è¯•
```
æœåŠ¡å™¨: http://localhost:3001
å‰ç«¯: http://localhost:5173
```

#### å±€åŸŸç½‘
```
æœåŠ¡å™¨: http://192.168.1.7:3001
å‰ç«¯: http://192.168.1.7:5173
```

#### Sakura FRPï¼ˆå†…ç½‘ç©¿é€ï¼‰
1. å®‰è£… Sakura FRP å®¢æˆ·ç«¯
2. åˆ›å»ºéš§é“æ˜ å°„æœ¬åœ°ç«¯å£
3. é…ç½®æœåŠ¡å™¨åœ°å€ä¸º FRP æä¾›çš„åœ°å€
4. è¯¦è§ `SAKURA_FRP_GUIDE.md`ï¼ˆå¦‚æœä¿ç•™ï¼‰

### æµ‹è¯•æŒ‡å—

#### å‡†å¤‡å·¥ä½œ
1. å¯åŠ¨åç«¯æœåŠ¡å™¨: `cd server && npm start`
2. å¯åŠ¨å‰ç«¯: `npm run dev`
3. æ‰“å¼€ä¸¤ä¸ªæµè§ˆå™¨çª—å£:
   - çª—å£1: æ­£å¸¸æ¨¡å¼
   - çª—å£2: æ— ç—•æ¨¡å¼ï¼ˆCtrl+Shift+Nï¼‰

âš ï¸ **å¿…é¡»ä½¿ç”¨æ— ç—•æ¨¡å¼**ï¼Œå› ä¸ºåŒä¸€æµè§ˆå™¨çš„æ ‡ç­¾é¡µä¼šå…±äº« localStorage

#### æµ‹è¯•æ­¥éª¤
1. çª—å£1: è”æœºå¯¹æˆ˜ â†’ åˆ›å»ºæˆ¿é—´ â†’ è¾“å…¥åå­—
2. çª—å£2: è”æœºå¯¹æˆ˜ â†’ åŠ å…¥æˆ¿é—´ â†’ è¾“å…¥åå­—å’Œæˆ¿é—´ID
3. ç­‰å¾…è‡ªåŠ¨è¿›å…¥æ¸¸æˆ
4. æµ‹è¯•å‡ºç‰Œã€é‡é“¸ã€è·³è¿‡ç­‰æ“ä½œ
5. éªŒè¯åŒæ–¹èƒ½çœ‹åˆ°å¯¹æ–¹çš„æ“ä½œ

---

## å¼€å‘å†å²

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¸¸æˆå®ç°ï¼ˆæ—©æœŸï¼‰

**å®ç°å†…å®¹**:
- åˆ›å»ºåŸºç¡€çš„2äººå›åˆåˆ¶æ¸¸æˆï¼ˆç©å®¶ vs AIï¼‰
- å®ç°8å¼ ç®€å•å¡ç‰Œ
- åŸºæœ¬æ¸¸æˆæµç¨‹ï¼šæŠ½ç‰Œ â†’ å†³ç­– â†’ è¡ŒåŠ¨ â†’ ç»“æŸå›åˆ

**ç›¸å…³æ–‡ä»¶**:
- `src/composables/useGame.ts`
- `src/views/Game/CardGame.vue`

---

### ç¬¬äºŒé˜¶æ®µï¼šå®Œæ•´å¡ç‰Œç³»ç»Ÿï¼ˆæ—©æœŸï¼‰

**å®ç°å†…å®¹**:
- è®¾è®¡15å¼ å¤æ‚å¡ç‰Œ
- å®ç°å¡ç‰Œç±»å‹ç³»ç»Ÿï¼ˆå•ä½/ç¯å¢ƒ/æˆ˜æœ¯ï¼‰
- å®ç°å…³é”®è¯ç³»ç»Ÿ
- å®ç°æ•ˆæœç³»ç»Ÿï¼ˆéƒ¨ç½²/æŒç»­/æ¡ä»¶æ•ˆæœï¼‰
- å®ç°æ§½ä½é€‰æ‹©å’Œç›®æ ‡é€‰æ‹©
- å®ç°å åŠ æ•ˆæœï¼ˆæ³•å¸ˆã€æˆ˜å£«ã€çŸ®äººé“åŒ ï¼‰

**ç›¸å…³æ–‡ä»¶**:
- `src/types/game.ts`
- `src/data/cardDatabase.ts`
- `src/data/cards.ts`
- `src/game/effectManager.ts`
- `src/composables/useGameNew.ts`
- `src/views/Game/CardGameNew.vue`

---

### ç¬¬ä¸‰é˜¶æ®µï¼šè”æœºç³»ç»Ÿå®ç°

**å®ç°å†…å®¹**:
- åˆ›å»º Socket.IO åç«¯æœåŠ¡å™¨
- å®ç°æˆ¿é—´ç®¡ç†ç³»ç»Ÿ
- å®ç°è”æœºå¤§å…ç•Œé¢
- å®ç°è”æœºæ¸¸æˆé€»è¾‘
- æ·»åŠ æœåŠ¡å™¨é…ç½®ç³»ç»Ÿ
- æ”¯æŒ Sakura FRP å†…ç½‘ç©¿é€

**ç›¸å…³æ–‡ä»¶**:
- `server/index.js`
- `src/composables/useMultiplayer.ts`
- `src/composables/useGameMultiplayer.ts`
- `src/views/Game/MultiplayerLobby.vue`
- `src/views/Game/CardGameMultiplayer.vue`
- `src/config/multiplayer.ts`
- `src/views/Game/ServerConfigDialog.vue`

---

### ç¬¬å››é˜¶æ®µï¼šè”æœºç³»ç»Ÿè°ƒè¯•å’Œä¿®å¤

#### ä¿®å¤1: æˆ¿é—´ç®¡ç†é—®é¢˜
**é—®é¢˜**: 
- ç¬¬äºŒä¸ªç©å®¶åŠ å…¥åæˆ¿é—´å´©æºƒ
- ç©å®¶åç§°æ˜¾ç¤º undefined
- FRP é…ç½®ä¸ä¿å­˜

**è§£å†³æ–¹æ¡ˆ**:
- ç§»é™¤ MultiplayerLobby çš„ `onUnmounted` ä¸­çš„ `disconnect()`
- å®ç° localStorage æŒä¹…åŒ–é…ç½®
- ä½¿ç”¨ sessionStorage å®ç°æ ‡ç­¾é¡µéš”ç¦»
- ä¿®æ”¹æœåŠ¡å™¨æˆ¿é—´åˆ é™¤é€»è¾‘ï¼ˆæ¸¸æˆä¸­ä¿ç•™30ç§’ï¼‰

**ä¿®æ”¹æ–‡ä»¶**:
- `src/composables/useMultiplayer.ts`
- `src/config/multiplayer.ts`
- `src/views/Game/MultiplayerLobby.vue`
- `server/index.js`

---

#### ä¿®å¤2: æ“ä½œåŒæ­¥é—®é¢˜ï¼ˆå…³é”®ä¿®å¤ï¼‰
**é—®é¢˜**: 
- ç©å®¶èƒ½è¿›å…¥æ¸¸æˆä½†çœ‹ä¸åˆ°å¯¹æ–¹æ“ä½œ
- æœåŠ¡å™¨æ­£ç¡®å¹¿æ’­ä½†å®¢æˆ·ç«¯ä¸å¤„ç†
- åŒæ–¹éƒ½è®¤ä¸ºå¯¹æ–¹ä»€ä¹ˆéƒ½æ²¡åš

**æ ¹æœ¬åŸå› **: 
`connect()` å‡½æ•°ä¸­è®¾ç½®äº† `opponentAction` ç›‘å¬å™¨ï¼Œä½†åªæ‰“å°æ—¥å¿—ï¼Œä¸è°ƒç”¨å›è°ƒå‡½æ•°

**è§£å†³æ–¹æ¡ˆ**:
- ç§»é™¤ `connect()` ä¸­çš„ `opponentAction` ç›‘å¬å™¨
- è®©ç»„ä»¶é€šè¿‡ `onOpponentAction()` è®¾ç½®ç›‘å¬å™¨
- ç¡®ä¿å›è°ƒå‡½æ•°è¢«æ­£ç¡®è°ƒç”¨

**ä¿®æ”¹æ–‡ä»¶**:
- `src/composables/useMultiplayer.ts`

---

#### ä¿®å¤3: å¡ç‰Œæ•°æ®åº“IDé—®é¢˜ï¼ˆå…³é”®ä¿®å¤ï¼‰
**é—®é¢˜**: 
- æ“ä½œèƒ½å‘é€å’Œæ¥æ”¶
- æ—¥å¿—æ˜¾ç¤º `applyOpponentAction` è¢«è°ƒç”¨
- ä½†æ˜¾ç¤º"æœªæ‰¾åˆ°å¡ç‰Œæ•°æ®: card_009_unique"
- å¯¹æ‰‹çš„å¡ç‰Œæ— æ³•æ˜¾ç¤º

**æ ¹æœ¬åŸå› **: 
- å¡ç‰Œæ•°æ®åº“æ³¨å†Œçš„IDæ˜¯ `card_001`, `card_002` ç­‰
- ä½† `createDeck()` ä¸­ç»™æ¯å¼ å¡æ·»åŠ äº† `_unique` åç¼€
- `CardDatabase.get('card_009_unique')` æ‰¾ä¸åˆ°å¡ç‰Œ

**è§£å†³æ–¹æ¡ˆ**:
åœ¨ `applyOpponentAction` çš„ `playCard` å¤„ç†ä¸­ï¼š
```typescript
const baseCardId = cardId.replace('_unique', '')
const cardData = CardDatabase.get(baseCardId)
```

**ä¿®æ”¹æ–‡ä»¶**:
- `src/composables/useGameMultiplayer.ts`

---

#### ä¿®å¤4: å¯¹æ‰‹æ‰‹ç‰Œåˆå§‹åŒ–é—®é¢˜
**é—®é¢˜**: 
- å¯¹æ‰‹çš„æ‰‹ç‰Œåœ¨æœ¬åœ°éšæœºç”Ÿæˆ
- ä¸å¯¹æ‰‹å®é™…æ‰‹ç‰Œä¸ä¸€è‡´
- æ— æ³•æ‰¾åˆ°å¯¹åº”çš„å¡ç‰Œ

**è§£å†³æ–¹æ¡ˆ**:
- åªåˆå§‹åŒ–è‡ªå·±çš„ç‰Œç»„å’Œæ‰‹ç‰Œ
- å¯¹æ‰‹æ‰‹ç‰Œç”¨å ä½ç¬¦è¡¨ç¤ºï¼ˆåªæ˜¾ç¤ºæ•°é‡ï¼‰
- æ‰“å‡ºå¡ç‰Œæ—¶ä»æ•°æ®åº“è·å–å¡ç‰Œæ•°æ®

**ä¿®æ”¹æ–‡ä»¶**:
- `src/composables/useGameMultiplayer.ts`

---

#### ä¿®å¤5: è´¹ç”¨ä¸è¶³å¡ä½é—®é¢˜
**é—®é¢˜**: 
- è´¹ç”¨ä¸º0æ—¶æ— æ³•å‡ºç‰Œ
- æ²¡æœ‰è·³è¿‡æœºåˆ¶
- å›åˆæ— æ³•ç»§ç»­

**è§£å†³æ–¹æ¡ˆ**:
- æ·»åŠ "è·³è¿‡å›åˆ"æŒ‰é’®
- è´¹ç”¨ä¸º0æ—¶è‡ªåŠ¨æ˜¾ç¤º
- å‘é€ `skipTurn` æ“ä½œåŒæ­¥

**ä¿®æ”¹æ–‡ä»¶**:
- `src/views/Game/CardGameMultiplayer.vue`
- `src/types/game.ts`
- `src/composables/useGameMultiplayer.ts`

---

#### ä¿®å¤6: ç¦»å¼€æ¸¸æˆé—®é¢˜
**é—®é¢˜**: 
- ç¦»å¼€æ¸¸æˆè¿”å›è”æœºå¤§å…
- sessionStorage ä¸­çš„æˆ¿é—´ä¿¡æ¯æœªæ¸…ç†
- å†æ¬¡è¿›å…¥è‡ªåŠ¨é‡æ–°åŠ å…¥æ¸¸æˆ

**è§£å†³æ–¹æ¡ˆ**:
- ç¦»å¼€æ¸¸æˆæ—¶æ¸…ç† sessionStorage
- è¿”å›ä¸»é¡µè€Œä¸æ˜¯è”æœºå¤§å…

**ä¿®æ”¹æ–‡ä»¶**:
- `src/views/Game/CardGameMultiplayer.vue`

---

#### ä¿®å¤7: æœ€åä¸€å›åˆè§„åˆ™é—®é¢˜ï¼ˆæœ€ç»ˆä¿®å¤ï¼‰
**é—®é¢˜**: 
- å¡«æ»¡6ä¸ªæ§½ä½çš„ç©å®¶ç›´æ¥ç»“æŸæ¸¸æˆ
- å¯¹æ‰‹ä¸çŸ¥é“æ¸¸æˆç»“æŸï¼Œä¸€ç›´ç­‰å¾…
- ä¸ç¬¦åˆ"å¯¹æ‰‹è¿˜èƒ½å†è¿›è¡Œä¸€å›åˆ"çš„è§„åˆ™

**è§£å†³æ–¹æ¡ˆ**:
- æ·»åŠ  `finalRound` æ“ä½œç±»å‹åŒæ­¥æœ€åä¸€å›åˆçŠ¶æ€
- åˆ†ç¦» `checkFieldFull()` å’Œ `checkOpponentFieldFull()`
- å½“ä¸€æ–¹å¡«æ»¡åœºåœ°æ—¶é€šçŸ¥å¯¹æ‰‹
- åªæœ‰åŒæ–¹éƒ½å®Œæˆæ“ä½œåæ‰ç»“æŸæ¸¸æˆ

**ä¿®æ”¹æ–‡ä»¶**:
- `src/types/game.ts`
- `src/composables/useGameMultiplayer.ts`
- `src/views/Game/CardGameMultiplayer.vue`

---

### ç¬¬ä¸ƒé˜¶æ®µï¼šæ ¸å¿ƒæœºåˆ¶ä¿®å¤å’Œä¼˜åŒ–ï¼ˆ2026å¹´2æœˆ7æ—¥ 20:42ï¼‰

#### ä¿®å¤8: æ“ä½œç»‘å®šé—®é¢˜ï¼ˆä¸¥é‡Bugï¼‰
**é—®é¢˜**: 
- å½“ä¸€ä¸ªç©å®¶é€‰æ‹©å‡ºç‰Œæ—¶ï¼Œå¦ä¸€ä¸ªç©å®¶ä¹Ÿä¼šè‡ªåŠ¨é€‰æ‹©å‡ºç‰Œ
- ç©å®¶çš„æ“ä½œè¢«é”™è¯¯åœ°ç»‘å®šåœ¨ä¸€èµ·
- æ— æ³•ç‹¬ç«‹é€‰æ‹©è‡ªå·±çš„æ“ä½œ

**æ ¹æœ¬åŸå› **: 
- `applyOpponentAction` å‡½æ•°æ²¡æœ‰æ£€æŸ¥æ“ä½œæ¥æº
- è‡ªå·±å‘é€çš„æ“ä½œä¹Ÿä¼šè¢«è‡ªå·±æ¥æ”¶å¹¶åº”ç”¨
- ç¼ºå°‘ç©å®¶IDéªŒè¯æœºåˆ¶

**è§£å†³æ–¹æ¡ˆ**:
1. åœ¨ `GameAction` æ¥å£ä¸­æ·»åŠ  `playerId` å­—æ®µ
2. æœåŠ¡å™¨ç«¯åœ¨å¹¿æ’­æ“ä½œæ—¶æ·»åŠ å‘é€è€…çš„ç©å®¶ID
3. å®¢æˆ·ç«¯åœ¨ `applyOpponentAction` ä¸­æ£€æŸ¥ `action.playerId`
4. å¦‚æœæ“ä½œæ¥è‡ªè‡ªå·±ï¼Œç›´æ¥å¿½ç•¥ï¼Œé˜²æ­¢é‡å¤åº”ç”¨

**ä¿®æ”¹æ–‡ä»¶**:
- `src/types/game.ts` - æ·»åŠ  playerId å­—æ®µ
- `server/index.js` - åœ¨ gameAction äº‹ä»¶ä¸­æ·»åŠ  playerId
- `src/composables/useGameMultiplayer.ts` - æ·»åŠ ç©å®¶IDæ£€æŸ¥
- `src/views/Game/CardGameMultiplayer.vue` - å‘é€æ“ä½œæ—¶åŒ…å« playerId

---

#### ä¿®å¤9: æŒä¹…åŒ–ç©å®¶èº«ä»½ç³»ç»Ÿ
**é—®é¢˜**: 
- ç©å®¶åˆ·æ–°é¡µé¢åè¢«è§†ä¸ºæ–°ç©å®¶
- æ— æ³•è¯†åˆ«æ–­çº¿é‡è¿çš„ç©å®¶
- æˆ¿é—´ä¿¡æ¯ä¸¢å¤±

**è§£å†³æ–¹æ¡ˆ**:
1. ä½¿ç”¨ `localStorage` å­˜å‚¨æŒä¹…åŒ–ç©å®¶IDï¼ˆè·¨ä¼šè¯ï¼‰
2. ä½¿ç”¨ `sessionStorage` å­˜å‚¨å½“å‰ä¼šè¯çš„æˆ¿é—´ä¿¡æ¯
3. æœåŠ¡å™¨ç«¯ç»´æŠ¤ç©å®¶IDåˆ°socket IDçš„æ˜ å°„
4. æ”¯æŒç©å®¶ä½¿ç”¨æŒä¹…åŒ–IDé‡æ–°åŠ å…¥æˆ¿é—´

**å®ç°ç»†èŠ‚**:
- ç”Ÿæˆæ ¼å¼ï¼š`player_${timestamp}_${random}`
- é¦–æ¬¡è®¿é—®æ—¶ç”Ÿæˆå¹¶å­˜å‚¨åˆ° localStorage
- åˆ›å»º/åŠ å…¥æˆ¿é—´æ—¶æºå¸¦æŒä¹…åŒ–ID
- æœåŠ¡å™¨è¯†åˆ«å¹¶æ¢å¤ç©å®¶çŠ¶æ€

**ä¿®æ”¹æ–‡ä»¶**:
- `server/index.js` - æ·»åŠ  playerSockets Map å’Œ generatePlayerId å‡½æ•°
- `src/composables/useMultiplayer.ts` - æ·»åŠ  persistentPlayerId ç®¡ç†

---

#### ä¿®å¤10: ç©å®¶ç¦»å¼€é€šçŸ¥ç³»ç»Ÿ
**é—®é¢˜**: 
- ç©å®¶ç¦»å¼€åï¼Œå…¶ä»–ç©å®¶æ²¡æœ‰ä»»ä½•æç¤º
- æ¸¸æˆæŒç»­ç­‰å¾…å·²ç¦»å¼€çš„ç©å®¶æ“ä½œ
- æ— æ³•åˆ¤æ–­å¯¹æ‰‹æ˜¯å¦è¿˜åœ¨æ¸¸æˆä¸­

**è§£å†³æ–¹æ¡ˆ**:
1. æ·»åŠ  `leaveRoom` äº‹ä»¶å¤„ç†
2. æœåŠ¡å™¨å¹¿æ’­ `playerLeft` æ¶ˆæ¯ç»™æˆ¿é—´å†…å…¶ä»–ç©å®¶
3. å‰ç«¯æ˜¾ç¤º"æŸæŸç©å®¶å·²ç¦»å¼€æ¸¸æˆ"æç¤º
4. æ·»åŠ  `playerReconnected` äº‹ä»¶å¤„ç†é‡è¿æƒ…å†µ

**ä¿®æ”¹æ–‡ä»¶**:
- `server/index.js` - æ·»åŠ  leaveRoom äº‹ä»¶å’Œ playerLeft å¹¿æ’­
- `src/composables/useMultiplayer.ts` - æ·»åŠ  leaveRoom å‡½æ•°å’Œäº‹ä»¶ç›‘å¬
- `src/views/Game/CardGameMultiplayer.vue` - æ˜¾ç¤ºç¦»å¼€/é‡è¿æç¤º

---

#### ä¿®å¤11: æ–­çº¿é‡è¿æœºåˆ¶
**é—®é¢˜**: 
- ç©å®¶ç¦»å¼€åæˆ¿é—´ç«‹å³æ¶ˆå¤±
- æ— æ³•é‡æ–°åŠ å…¥æ­£åœ¨è¿›è¡Œçš„æ¸¸æˆ
- æ¸¸æˆè¿›åº¦æ— æ³•ä¿å­˜

**è§£å†³æ–¹æ¡ˆ**:
1. æœåŠ¡å™¨ä¿ç•™æˆ¿é—´5åˆ†é’Ÿï¼ˆæ‰€æœ‰ç©å®¶ç¦»çº¿åï¼‰
2. ä½¿ç”¨æŒä¹…åŒ–ç©å®¶IDè¯†åˆ«é‡è¿ç©å®¶
3. ä¿å­˜æ¸¸æˆçŠ¶æ€ï¼ˆactionHistoryï¼‰
4. é‡è¿æ—¶æ¢å¤æ¸¸æˆè¿›åº¦

**ä¿®æ”¹æ–‡ä»¶**:
- `server/index.js` - æ·»åŠ æˆ¿é—´ä¿ç•™é€»è¾‘å’Œ actionHistory

---

### ç¬¬å…«é˜¶æ®µï¼šæƒå¨æœåŠ¡å™¨æ¶æ„é‡æ„ï¼ˆ2026å¹´2æœˆ11æ—¥ï¼‰

#### é‡æ„1: å®Œæ•´ç§»æ¤æ¸¸æˆé€»è¾‘åˆ°æœåŠ¡å™¨ç«¯ï¼ˆæ ¸å¿ƒé‡æ„ï¼‰
**é—®é¢˜**: 
- æ¸¸æˆé€»è¾‘åœ¨å®¢æˆ·ç«¯æ‰§è¡Œï¼Œå®¹æ˜“ä½œå¼Š
- å®¢æˆ·ç«¯éœ€è¦ç»´æŠ¤å®Œæ•´çš„æ¸¸æˆçŠ¶æ€
- ç‰Œç»„è¢«ç®€åŒ–ä¸ºæµ‹è¯•æ•°æ®ï¼ˆåªæœ‰ç®€å•çš„æˆ˜å£«ã€æ³•å¸ˆç­‰ï¼‰
- å‡ºç‰Œå’Œé‡é“¸é€»è¾‘ç¼ºå¤±
- ç©å®¶äºŒç‰Œç»„é‡Œæ²¡æœ‰ç‰Œå¯ä»¥æ‰“

**æ ¹æœ¬åŸå› **: 
- ä¹‹å‰çš„ `server/gameEngine.js` ä½¿ç”¨äº†ç®€åŒ–çš„æµ‹è¯•å¡ç‰Œæ•°æ®
- æ²¡æœ‰å®Œæ•´ç§»æ¤å®¢æˆ·ç«¯çš„æ¸¸æˆé€»è¾‘
- ç¼ºå°‘æ•ˆæœç®¡ç†å™¨ï¼ˆEffectManagerï¼‰
- ç¼ºå°‘å®Œæ•´çš„15å¼ å¡ç‰Œæ•°æ®

**è§£å†³æ–¹æ¡ˆ**:
1. å®Œå…¨é‡å†™ `server/gameEngine.js`
2. ä» `src/composables/useGameMultiplayer.ts` å®Œæ•´å¤åˆ¶æ¸¸æˆé€»è¾‘
3. ä» `src/game/effectManager.ts` å®Œæ•´ç§»æ¤æ•ˆæœç®¡ç†å™¨
4. ä½¿ç”¨ `server/cardData.js` ä¸­çš„æ­£ç¡®15å¼ å¡ç‰Œæ•°æ®
5. ç¡®ä¿åŒ…å«æ‰€æœ‰æ¸¸æˆé€»è¾‘ï¼š
   - æ­£ç¡®çš„ç‰Œç»„åˆ›å»ºï¼ˆ15å¼ å¡ï¼Œæ¯å¼ 1å¼ ï¼‰
   - åˆå§‹æŠ½3å¼ ç‰Œ
   - æ¯å›åˆæŠ½1å¼ ç‰Œ
   - å‡ºç‰Œé€»è¾‘ï¼ˆè´¹ç”¨éªŒè¯ã€æ§½ä½é€‰æ‹©ï¼‰
   - é‡é“¸é€»è¾‘ï¼ˆgainCost, gainPower, redrawï¼‰
   - æ•ˆæœç®¡ç†å™¨ï¼ˆonDeploy, onField, onOtherPlayç­‰ï¼‰
   - æˆ˜åŠ›è®¡ç®—
   - å›åˆç®¡ç†
   - æ¸¸æˆç»“æŸåˆ¤å®š

**å®ç°ç»†èŠ‚**:
- æœåŠ¡å™¨ç«¯æˆä¸ºæ¸¸æˆçš„å”¯ä¸€çœŸç›¸æº
- å®¢æˆ·ç«¯åªè´Ÿè´£æ˜¾ç¤ºå’Œå‘é€æ“ä½œè¯·æ±‚
- æ‰€æœ‰æ¸¸æˆé€»è¾‘åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œ
- å®¢æˆ·ç«¯æ¥æ”¶æœåŠ¡å™¨å¹¿æ’­çš„æ¸¸æˆçŠ¶æ€æ›´æ–°

**ä¿®æ”¹æ–‡ä»¶**:
- `server/gameEngine.js` - å®Œå…¨é‡å†™ï¼ŒåŒ…å«å®Œæ•´æ¸¸æˆé€»è¾‘å’Œæ•ˆæœç®¡ç†å™¨
- `server/cardData.js` - å·²åŒ…å«æ­£ç¡®çš„15å¼ å¡ç‰Œæ•°æ®
- `server/index.js` - å·²æ­£ç¡®é›†æˆæ¸¸æˆå¼•æ“
- `src/composables/useGameClient.ts` - ç®€åŒ–çš„å®¢æˆ·ç«¯é€»è¾‘
- `src/views/Game/CardGameMultiplayer.vue` - ä½¿ç”¨æ–°æ¶æ„
- `src/composables/useMultiplayer.ts` - æ·»åŠ  gameStateUpdate æ”¯æŒå’ŒçŠ¶æ€ç¼“å­˜

**æŠ€æœ¯è¦ç‚¹**:
- ä½¿ç”¨ `createDeck()` å’Œ `shuffleDeck()` åˆ›å»ºæ­£ç¡®çš„ç‰Œç»„
- æ¯å¼ å¡æ·»åŠ  `_unique` åç¼€ç¡®ä¿å”¯ä¸€æ€§
- å®Œæ•´çš„æ•ˆæœç®¡ç†å™¨ç±»ï¼ˆEffectManagerï¼‰
- æ”¯æŒæ‰€æœ‰å¡ç‰Œæ•ˆæœï¼š
  - è§ä¹ å†’é™©è€…ï¼šåœºä¸Šæ¯ç§ä¸åŒå…³é”®è¯+1æˆ˜åŠ›
  - é‡çŒªï¼šæ¡ä»¶æˆ˜åŠ›å˜åŒ–
  - æ³•å¸ˆï¼šæ‰“å‡ºé­”æ³•æˆ˜æœ¯ç‰Œæ—¶+2æˆ˜åŠ›
  - æˆ˜å£«ï¼šæ‰“å‡ºæ­¦å™¨æ—¶+1æˆ˜åŠ›
  - çŸ®äººé“åŒ ï¼šæ‰“å‡ºæ­¦å™¨/æŠ¤ç”²æ—¶ç›®æ ‡+2æˆ˜åŠ›
  - å†œç”°ï¼šéƒ¨ç½²åŠ¡å†œå•ä½æ—¶+1æˆ˜åŠ›
  - æ©¡æœ¨æ­¦å™¨åº—ï¼šæˆ˜å£«/å£«å…µ/å†’é™©è€…+3æˆ˜åŠ›
  - é“åŒ é“ºï¼šç‰¹æ®Šç»„åˆ+15æˆ˜åŠ›
  - è¾›å‹¤çš„è‹¦å·¥ï¼šé¢å¤–å‡ºç‰Œ
  - é©®ç”¨é©¬/ç‹®é¹«ï¼šåˆ›å»ºé¢å¤–æ§½ä½
  - æˆ˜æœ¯ç‰Œï¼šç›®æ ‡é€‰æ‹©å’Œæ•ˆæœåº”ç”¨

**æµ‹è¯•éªŒè¯**:
- æœåŠ¡å™¨æˆåŠŸå¯åŠ¨åœ¨ç«¯å£ 3001
- æ¸¸æˆå¼•æ“æ­£ç¡®åˆå§‹åŒ–
- ç©å®¶æ‰‹ç‰ŒåŒ…å«æ­£ç¡®çš„å¡ç‰Œåç§°
- æ‰€æœ‰æ¸¸æˆé€»è¾‘åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œ

**è§£å†³æ–¹æ¡ˆ**:
1. æˆ¿é—´ä¸å†ç«‹å³åˆ é™¤ï¼Œè€Œæ˜¯æ ‡è®°ç©å®¶ä¸ºç¦»çº¿çŠ¶æ€
2. ç©å®¶æ–­çº¿æ—¶ä¿ç•™æˆ¿é—´5åˆ†é’Ÿ
3. ä½¿ç”¨æŒä¹…åŒ–ç©å®¶IDè¯†åˆ«é‡è¿ç©å®¶
4. é‡è¿æ—¶æ¢å¤æ¸¸æˆçŠ¶æ€å’Œæˆ¿é—´ä¿¡æ¯
5. åªæœ‰æ‰€æœ‰ç©å®¶éƒ½ç¦»çº¿è¶…è¿‡5åˆ†é’Ÿæ‰åˆ é™¤æˆ¿é—´

**å®ç°ç»†èŠ‚**:
- ç©å®¶å¯¹è±¡æ·»åŠ  `isOnline` å’Œ `disconnectedAt` å­—æ®µ
- `disconnect` äº‹ä»¶æ ‡è®°ç©å®¶ç¦»çº¿è€Œä¸åˆ é™¤
- `joinRoom` äº‹ä»¶æ£€æŸ¥æ˜¯å¦ä¸ºé‡è¿ç©å®¶
- é‡è¿æˆåŠŸåå¹¿æ’­ `playerReconnected` äº‹ä»¶

**ä¿®æ”¹æ–‡ä»¶**:
- `server/index.js` - ä¿®æ”¹ disconnect å’Œ joinRoom é€»è¾‘
- `src/composables/useMultiplayer.ts` - æ·»åŠ é‡è¿äº‹ä»¶ç›‘å¬

---

#### å¾…å®ç°: å¡ç‰ŒåŒæ—¶æ­ç¤ºæœºåˆ¶
**éœ€æ±‚**: 
- ç©å®¶å‡ºç‰Œæ—¶ï¼Œå¡ç‰Œåº”è¯¥å¯¹å…¶ä»–ç©å®¶éšè—
- ç­‰æ‰€æœ‰ç©å®¶éƒ½å‡ºç‰Œåï¼Œå¡ç‰ŒåŒæ—¶æ­ç¤º
- å®ç°çœŸæ­£çš„"åŒæ—¶å›åˆ"æœºåˆ¶

**è®¡åˆ’æ–¹æ¡ˆ**:
1. åœ¨ GameState ä¸­æ·»åŠ  `pendingReveals` å­˜å‚¨å¾…æ­ç¤ºçš„å¡ç‰Œ
2. ç©å®¶å‡ºç‰Œæ—¶åªå‘é€"å·²å‡ºç‰Œ"ä¿¡å·ï¼Œä¸å‘é€å…·ä½“å¡ç‰Œä¿¡æ¯
3. æ‰€æœ‰ç©å®¶éƒ½å‡ºç‰Œåï¼ŒæœåŠ¡å™¨è§¦å‘ `revealCards` äº‹ä»¶
4. åŒæ—¶æ­ç¤ºæ‰€æœ‰ç©å®¶çš„å¡ç‰Œ

**çŠ¶æ€**: å¾…å®ç°ï¼ˆä¸‹ä¸€é˜¶æ®µï¼‰

---

### ç¬¬å…«é˜¶æ®µï¼šæ·±åº¦Bugä¿®å¤ï¼ˆ2026å¹´2æœˆ7æ—¥ 20:58ï¼‰

#### é—®é¢˜åé¦ˆ
ç”¨æˆ·æµ‹è¯•åå‘ç°ä¹‹å‰çš„ä¿®å¤å¹¶æœªå®Œå…¨ç”Ÿæ•ˆï¼š
1. æŒä¹…åŒ–ç©å®¶èº«ä»½æœªç”Ÿæ•ˆ - åˆ·æ–°åä»è¢«è¯†åˆ«ä¸ºæ–°ç©å®¶
2. æˆ¿é—´é‡è¿å¤±è´¥ - æ–­çº¿ç©å®¶é‡è¿åçœ‹ä¸åˆ°æˆ¿é—´
3. æ“ä½œç»‘å®šé—®é¢˜ä¾ç„¶å­˜åœ¨ - ä¸€ä¸ªç©å®¶é€‰æ‹©å‡ºç‰Œï¼Œå¦ä¸€ä¸ªç©å®¶ä¹Ÿè‡ªåŠ¨è¿›å…¥å‡ºç‰Œé˜¶æ®µ

#### ä¿®å¤12: æŒä¹…åŒ–ç©å®¶IDæ¢å¤æœºåˆ¶
**æ ¹æœ¬åŸå› **: 
- `connect` äº‹ä»¶ä¸­æ²¡æœ‰æ­£ç¡®æ¢å¤ `myPlayerId`
- åªä» sessionStorage è¯»å–ä½†æ²¡æœ‰åº”ç”¨
- persistentPlayerId ä¼ é€’åˆ°æœåŠ¡å™¨ä½†æœªæ­£ç¡®ä½¿ç”¨

**è§£å†³æ–¹æ¡ˆ**:
1. åœ¨ `connect` äº‹ä»¶ä¸­ä» sessionStorage æ¢å¤ `myPlayerId`
2. `rejoinRoom` æ—¶ä¼ é€’ `persistentPlayerId`
3. æœåŠ¡å™¨ç«¯ä½¿ç”¨ `persistentPlayerId` æŸ¥æ‰¾ç©å®¶
4. æ›´æ–°ç©å®¶çš„ socketId å’Œåœ¨çº¿çŠ¶æ€

**ä¿®æ”¹æ–‡ä»¶**:
- `src/composables/useMultiplayer.ts` - æ¢å¤ myPlayerId é€»è¾‘
- `server/index.js` - rejoinRoom ä½¿ç”¨ persistentPlayerId æŸ¥æ‰¾ç©å®¶

---

#### ä¿®å¤13: æˆ¿é—´åˆ—è¡¨æ˜¾ç¤ºæ‰€æœ‰æˆ¿é—´
**é—®é¢˜**: 
- æˆ¿é—´åˆ—è¡¨åªæ˜¾ç¤º `waiting` çŠ¶æ€çš„æˆ¿é—´
- æ­£åœ¨æ¸¸æˆçš„æˆ¿é—´ä¸æ˜¾ç¤ºï¼Œå¯¼è‡´æ–­çº¿ç©å®¶æ‰¾ä¸åˆ°æˆ¿é—´

**è§£å†³æ–¹æ¡ˆ**:
1. `getRooms` è¿”å›æ‰€æœ‰æˆ¿é—´ï¼Œä¸è¿‡æ»¤çŠ¶æ€
2. æ·»åŠ æˆ¿é—´çŠ¶æ€å­—æ®µï¼ˆwaiting/playingï¼‰
3. æ·»åŠ åœ¨çº¿ç©å®¶æ•°é‡å­—æ®µ
4. å‰ç«¯æ˜¾ç¤ºæˆ¿é—´çŠ¶æ€ï¼Œæ¸¸æˆä¸­çš„æˆ¿é—´æ ‡è®°ä¸º"æ¸¸æˆä¸­"
5. æ¸¸æˆä¸­çš„æˆ¿é—´ä¸å¯ç‚¹å‡»åŠ å…¥ï¼ˆä»…ä¾›é‡è¿ï¼‰

**ä¿®æ”¹æ–‡ä»¶**:
- `server/index.js` - getRooms è¿”å›æ‰€æœ‰æˆ¿é—´
- `src/views/Game/MultiplayerLobby.vue` - æ˜¾ç¤ºæˆ¿é—´çŠ¶æ€å’Œæ ·å¼

---

#### ä¿®å¤14: æ“ä½œç»‘å®šé—®é¢˜çš„çœŸæ­£åŸå› 
**æ·±å±‚åŸå› **: 
- `applyOpponentAction` ä¸­çš„ `choosePlay` å’Œ `chooseReforge` åˆ†æ”¯è™½ç„¶æ˜¯ç©ºçš„
- ä½†è¿™äº›æ“ä½œä¼šè§¦å‘å…¶ä»–é€»è¾‘
- å…³é”®é—®é¢˜ï¼šè¿™äº›æ“ä½œä¸åº”è¯¥æ”¹å˜æœ¬åœ°ç©å®¶çš„æ¸¸æˆé˜¶æ®µ

**æœ€ç»ˆè§£å†³æ–¹æ¡ˆ**:
1. åœ¨ `applyOpponentAction` çš„ `choosePlay` å’Œ `chooseReforge` åˆ†æ”¯ä¸­
2. æ˜ç¡®æ³¨é‡Šï¼šä¸è¦è°ƒç”¨æœ¬åœ°å‡½æ•°ï¼Œä¸è¦æ”¹å˜æœ¬åœ°çŠ¶æ€
3. åªè®°å½•å¯¹æ‰‹çš„é€‰æ‹©ï¼Œä¸å½±å“è‡ªå·±çš„å†³ç­–é˜¶æ®µ
4. ç¡®ä¿æ¯ä¸ªç©å®¶çš„ `phase` çŠ¶æ€å®Œå…¨ç‹¬ç«‹

**ä¿®æ”¹æ–‡ä»¶**:
- `src/composables/useGameMultiplayer.ts` - æ·»åŠ æ˜ç¡®æ³¨é‡Šå’Œè¯´æ˜

---

### ç¬¬ä¹é˜¶æ®µï¼šæ ¸å¿ƒé—®é¢˜æ·±åº¦ä¿®å¤ï¼ˆ2026å¹´2æœˆ7æ—¥ 21:10ï¼‰

#### é—®é¢˜åé¦ˆï¼ˆç¬¬äºŒè½®æµ‹è¯•ï¼‰
ç”¨æˆ·å†æ¬¡æµ‹è¯•åå‘ç°é—®é¢˜ä¾ç„¶å­˜åœ¨ï¼š
1. **æŒä¹…åŒ–ç©å®¶IDå¤±æ•ˆ** - ç»ˆç«¯æ˜¾ç¤ºæ¯æ¬¡è¿æ¥éƒ½æ˜¯ä¸åŒçš„ socketIdï¼ŒpersistentPlayerId æœªç”Ÿæ•ˆ
2. **æˆ¿é—´é‡è¿å¤±è´¥** - å³ä½¿æˆ¿é—´æ˜¾ç¤º"æ¸¸æˆä¸­1/2"ï¼Œæ–­çº¿ç©å®¶ä¹Ÿæ— æ³•é‡æ–°åŠ å…¥
3. **å‡ºç‰Œæ“ä½œç»‘å®š** - ä¸€ä¸ªç©å®¶ç‚¹å‡»"å‡ºç‰Œ"ï¼Œå¦ä¸€ä¸ªç©å®¶è‡ªåŠ¨è¿›å…¥å‡ºç‰Œé˜¶æ®µï¼ˆé‡é“¸æ­£å¸¸ï¼‰

#### ä¿®å¤15: æŒä¹…åŒ–ç©å®¶IDçš„æ ¹æœ¬é—®é¢˜
**æ·±å±‚åŸå› **: 
- `persistentPlayerId` å­˜å‚¨åœ¨ `ref` ä¸­ï¼Œä½†æ¯æ¬¡åˆ·æ–°é¡µé¢ `tabId` æ”¹å˜
- æ–°çš„ `tabId` åˆ›å»ºæ–°å®ä¾‹ï¼Œè™½ç„¶ä» localStorage è¯»å–ä½†æœªæ­£ç¡®åº”ç”¨
- `getInstance()` åªåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶è®¾ç½® `persistentPlayerId`

**æœ€ç»ˆè§£å†³æ–¹æ¡ˆ**:
1. åˆ›å»ºç‹¬ç«‹çš„ `getPersistentPlayerId()` å‡½æ•°ï¼Œæ¯æ¬¡éƒ½ä» localStorage è¯»å–
2. å°† `persistentPlayerId` æ”¹ä¸ºç›´æ¥å­˜å‚¨å­—ç¬¦ä¸²è€Œä¸æ˜¯ ref
3. åœ¨ `getInstance()` ä¸­æ¯æ¬¡éƒ½æ›´æ–° `persistentPlayerId`
4. åœ¨æ‰€æœ‰éœ€è¦ä½¿ç”¨çš„åœ°æ–¹è°ƒç”¨ `getPersistentPlayerId()` è·å–æœ€æ–°å€¼
5. æ·»åŠ è¯¦ç»†æ—¥å¿—è¾“å‡ºï¼Œä¾¿äºè°ƒè¯•

**ä¿®æ”¹æ–‡ä»¶**:
- `src/composables/useMultiplayer.ts` - é‡æ„ persistentPlayerId ç®¡ç†

---

#### ä¿®å¤16: å‡ºç‰Œæ“ä½œç»‘å®šçš„çœŸæ­£åŸå› 
**æ ¹æœ¬åŸå› å‘ç°**: 
- é€šè¿‡å¯¹æ¯”"å‡ºç‰Œ"å’Œ"é‡é“¸"å‘ç°ï¼šä¸¤è€…éƒ½è°ƒç”¨ç›¸åŒçš„é€»è¾‘
- é—®é¢˜ä¸åœ¨ `applyOpponentAction` å‡½æ•°æœ¬èº«
- **çœŸæ­£åŸå› **ï¼š`choosePlay()` å’Œ `chooseReforge()` å‡½æ•°ä¼šä¿®æ”¹ `gameState.phase`
- `gameState` æ˜¯ä¸€ä¸ªå…±äº«çš„ ref å¯¹è±¡
- è™½ç„¶æˆ‘ä»¬ä¸åœ¨ `applyOpponentAction` ä¸­è°ƒç”¨è¿™äº›å‡½æ•°ï¼Œä½†é—®é¢˜å·²ç»åœ¨æœ¬åœ°å‡½æ•°ä¸­äº§ç”Ÿ

**ä¸ºä»€ä¹ˆé‡é“¸æ­£å¸¸ï¼Ÿ**
- å› ä¸ºé‡é“¸æœ‰é¢å¤–çš„ `reforgeState.active` æ ‡å¿—
- è¿™ä¸ªæ ‡å¿—æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¼šè¢«å¯¹æ‰‹çš„æ“ä½œå½±å“

**æœ€ç»ˆè§£å†³æ–¹æ¡ˆ**:
1. åœ¨ `choosePlay()` å’Œ `chooseReforge()` ä¸­æ·»åŠ  `playerId`
2. åœ¨ `applyOpponentAction` ä¸­æ·»åŠ æ›´æ˜ç¡®çš„æ³¨é‡Š
3. ç¡®ä¿ä¸ä¼šæœ‰ä»»ä½•ä»£ç è·¯å¾„å¯¼è‡´å¯¹æ‰‹çš„æ“ä½œå½±å“æœ¬åœ°çŠ¶æ€
4. å…³é”®ï¼šæ¯ä¸ªç©å®¶çš„å†³ç­–é˜¶æ®µå¿…é¡»å®Œå…¨ç‹¬ç«‹

**ä¿®æ”¹æ–‡ä»¶**:
- `src/composables/useGameMultiplayer.ts` - æ·»åŠ  playerId åˆ°è¿”å›çš„ action
- `src/views/Game/CardGameMultiplayer.vue` - ç§»é™¤é‡å¤çš„ playerId è®¾ç½®

---

#### ä¿®å¤17: æˆ¿é—´é‡è¿æœºåˆ¶å®Œå–„
**é—®é¢˜**: 
- æˆ¿é—´åˆ—è¡¨æ˜¾ç¤º"æ¸¸æˆä¸­1/2"ä½†æ— æ³•é‡æ–°åŠ å…¥
- `joinRoom` äº‹ä»¶æ‹’ç»åŠ å…¥ `playing` çŠ¶æ€çš„æˆ¿é—´

**è§£å†³æ–¹æ¡ˆ**:
1. ä¿®æ”¹ `joinRoom` é€»è¾‘ï¼š
   - é¦–å…ˆæ£€æŸ¥æ˜¯å¦æ˜¯é‡è¿ç©å®¶ï¼ˆä½¿ç”¨ persistentPlayerIdï¼‰
   - å¦‚æœæ˜¯é‡è¿ï¼Œå…è®¸åŠ å…¥ä»»ä½•çŠ¶æ€çš„æˆ¿é—´
   - å¦‚æœæ˜¯æ–°ç©å®¶ï¼Œåªèƒ½åŠ å…¥ `waiting` çŠ¶æ€çš„æˆ¿é—´
2. æ·»åŠ  `isOnline` å­—æ®µåˆ°ç©å®¶å¯¹è±¡
3. é‡è¿æ—¶æ›´æ–°ç©å®¶çš„åœ¨çº¿çŠ¶æ€

**ä¿®æ”¹æ–‡ä»¶**:
- `server/index.js` - ä¿®æ”¹ joinRoom é€»è¾‘ï¼Œä¼˜å…ˆæ£€æŸ¥é‡è¿

---

### ç¬¬åé˜¶æ®µï¼šç‹¬ç«‹å†³ç­–ç³»ç»Ÿå’Œå›åˆç®¡ç†ä¿®å¤ï¼ˆ2026å¹´2æœˆ11æ—¥ 19:13-19:41ï¼‰

#### é—®é¢˜åé¦ˆï¼ˆæ™šé—´æµ‹è¯•ï¼‰
ç”¨æˆ·åœ¨ä¸‹åˆ15:15ç¦»å¼€åï¼Œæ™šä¸Š19:13å›æ¥ç»§ç»­æµ‹è¯•ï¼Œå‘ç°ä»¥ä¸‹é—®é¢˜ï¼š
1. **æ“ä½œç»‘å®šé—®é¢˜å¤ç°** - ä¸€å·ç©å®¶ç‚¹å‡»"å‡ºç‰Œ"ï¼ŒäºŒå·ç©å®¶ä¹Ÿè‡ªåŠ¨è¿›å…¥å‡ºç‰ŒçŠ¶æ€
2. **å›åˆç®¡ç†å¤±æ•ˆ** - åŒæ–¹æ‰“å‡ºç‰Œåï¼Œæ¸¸æˆæ— æ³•è¿›å…¥ä¸‹ä¸€å›åˆ
3. **ç¼ºå°‘ç­‰å¾…æç¤º** - ç©å®¶å†³ç­–åæ²¡æœ‰"ç­‰å¾…å¯¹æ‰‹..."çš„æç¤º

#### ä¿®å¤18: ç‹¬ç«‹å†³ç­–ç³»ç»Ÿï¼ˆæ ¸å¿ƒä¿®å¤ï¼‰
**æ ¹æœ¬åŸå› åˆ†æ**:
é€šè¿‡è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—å‘ç°ï¼š
- æœåŠ¡å™¨ç«¯çš„ `phase` æ˜¯å…¨å±€çš„
- å½“ä¸€ä¸ªç©å®¶é€‰æ‹©å‡ºç‰Œåï¼ŒæœåŠ¡å™¨ç«‹å³æŠŠ `phase` æ”¹ä¸º `'action'`
- ç„¶åå¹¿æ’­ç»™æ‰€æœ‰ç©å®¶ï¼Œå¯¼è‡´ä¸¤ä¸ªç©å®¶éƒ½è¿›å…¥ `action` é˜¶æ®µ
- å®¢æˆ·ç«¯é€»è¾‘ï¼šå¦‚æœ `phase === 'action'` ä¸” `myDecisionMade === false`ï¼Œå°±è®¤ä¸ºå¯¹æ‰‹å·²å†³ç­–
- ä½†å®é™…ä¸Šï¼Œå¯èƒ½æ˜¯è‡ªå·±è¿˜æ²¡å†³ç­–ï¼Œå¯¹æ‰‹å…ˆå†³ç­–äº†

**è§£å†³æ–¹æ¡ˆ**:
1. **æœåŠ¡å™¨ç«¯æ·»åŠ ç‹¬ç«‹å†³ç­–è·Ÿè¸ª**ï¼š
   - åœ¨ `gameState` ä¸­æ·»åŠ  `playerDecisions` å¯¹è±¡
   - è®°å½•æ¯ä¸ªç©å®¶çš„å†³ç­–çŠ¶æ€ï¼š`{ made: boolean, choice: 'play' | 'reforge' | null }`
   - åªæœ‰å½“ä¸¤ä¸ªç©å®¶éƒ½å†³ç­–åï¼Œæ‰æ”¹å˜ `phase` ä¸º `'action'`
   - å¦‚æœåªæœ‰ä¸€ä¸ªç©å®¶å†³ç­–ï¼Œä¿æŒ `phase` ä¸º `'decision'`ï¼Œæ¶ˆæ¯æ˜¾ç¤º"ç­‰å¾…å¯¹æ‰‹..."

2. **ä¿®æ”¹å†³ç­–å¤„ç†é€»è¾‘**ï¼š
   ```javascript
   handleChoosePlay(playerId) {
     // è®°å½•ç©å®¶å†³ç­–
     this.gameState.playerDecisions[playerId] = { made: true, choice: 'play' }
     
     // æ£€æŸ¥æ˜¯å¦ä¸¤ä¸ªç©å®¶éƒ½å·²å†³ç­–
     const allDecided = Object.values(this.gameState.playerDecisions).every(d => d.made)
     
     if (allDecided) {
       this.gameState.phase = 'action'
       this.gameState.message = 'åŒæ–¹å·²å†³ç­–ï¼Œå¼€å§‹è¡ŒåŠ¨'
     } else {
       this.gameState.message = `${player.name} é€‰æ‹©å‡ºç‰Œï¼Œç­‰å¾…å¯¹æ‰‹...`
     }
   }
   ```

3. **æ–°å›åˆé‡ç½®å†³ç­–çŠ¶æ€**ï¼š
   - åœ¨ `startNewRound()` ä¸­é‡ç½®æ‰€æœ‰ç©å®¶çš„å†³ç­–çŠ¶æ€

4. **å®¢æˆ·ç«¯é€»è¾‘ç®€åŒ–**ï¼š
   - ç§»é™¤é”™è¯¯çš„åˆ¤æ–­é€»è¾‘
   - åªåœ¨ `phase === 'action'` æ—¶æ ‡è®°åŒæ–¹éƒ½å·²å†³ç­–

**ä¿®æ”¹æ–‡ä»¶**:
- `server/gameEngine.js` - æ·»åŠ  playerDecisions è·Ÿè¸ªï¼Œä¿®æ”¹ handleChoosePlay å’Œ handleChooseReforge
- `src/views/Game/CardGameMultiplayer.vue` - ç®€åŒ–çŠ¶æ€æ›´æ–°é€»è¾‘

**æµ‹è¯•ç»“æœ**:
- âœ… ä¸€å·ç©å®¶ç‚¹å‡»"å‡ºç‰Œ"åï¼Œåªæœ‰è‡ªå·±è¿›å…¥ç­‰å¾…çŠ¶æ€
- âœ… äºŒå·ç©å®¶ä»ç„¶å¯ä»¥ç‹¬ç«‹é€‰æ‹©"å‡ºç‰Œ"æˆ–"é‡é“¸"
- âœ… åªæœ‰åŒæ–¹éƒ½å†³ç­–åï¼Œæ‰è¿›å…¥ action é˜¶æ®µ

---

#### ä¿®å¤19: è‡ªåŠ¨å›åˆç®¡ç†ç³»ç»Ÿ
**é—®é¢˜**: 
- åŒæ–¹æ‰“å‡ºç‰Œåï¼Œæ¸¸æˆå¡ä½ï¼Œæ— æ³•è¿›å…¥ä¸‹ä¸€å›åˆ
- å®¢æˆ·ç«¯ä½¿ç”¨ `bothPlayersReady` åˆ¤æ–­ï¼Œä½†æœåŠ¡å™¨ç«¯æ²¡æœ‰è·Ÿè¸ªè¿™ä¸ªçŠ¶æ€

**è§£å†³æ–¹æ¡ˆ**:
1. **æœåŠ¡å™¨ç«¯æ·»åŠ å‡†å¤‡çŠ¶æ€è·Ÿè¸ª**ï¼š
   - åœ¨ `gameState` ä¸­æ·»åŠ  `playerReady` å¯¹è±¡
   - è®°å½•æ¯ä¸ªç©å®¶æ˜¯å¦å‡†å¤‡å®Œæˆï¼š`{ [playerId]: boolean }`

2. **è‡ªåŠ¨æ ‡è®°å‡†å¤‡å®Œæˆ**ï¼š
   - åœ¨ `handlePlayCard` ä¸­ï¼Œç©å®¶å‡ºç‰Œåï¼ˆä¸”ä¸èƒ½å†å‡ºç‰Œæ—¶ï¼‰ï¼Œè‡ªåŠ¨æ ‡è®°ä¸ºå‡†å¤‡å®Œæˆ
   - æ£€æŸ¥æ˜¯å¦ä¸¤ä¸ªç©å®¶éƒ½å‡†å¤‡å¥½
   - å¦‚æœéƒ½å‡†å¤‡å¥½ï¼Œæ›´æ–°æ¶ˆæ¯æç¤º

3. **å®¢æˆ·ç«¯è‡ªåŠ¨è¿›å…¥ä¸‹ä¸€å›åˆ**ï¼š
   - å®¢æˆ·ç«¯æ£€æµ‹åˆ°æœåŠ¡å™¨çš„ `playerReady` çŠ¶æ€
   - å¦‚æœåŒæ–¹éƒ½å‡†å¤‡å¥½ï¼Œ2ç§’åè‡ªåŠ¨å‘é€ `startNewRound` è¯·æ±‚
   - å¦‚æœæ˜¯æœ€åä¸€å›åˆï¼Œå‘é€ `endGame` è¯·æ±‚

4. **æ–°å›åˆé‡ç½®å‡†å¤‡çŠ¶æ€**ï¼š
   - åœ¨ `startNewRound()` ä¸­é‡ç½®æ‰€æœ‰ç©å®¶çš„å‡†å¤‡çŠ¶æ€

**ä¿®æ”¹æ–‡ä»¶**:
- `server/gameEngine.js` - æ·»åŠ  playerReady è·Ÿè¸ªï¼Œä¿®æ”¹ handlePlayCard å’Œ startNewRound
- `src/views/Game/CardGameMultiplayer.vue` - æ·»åŠ è‡ªåŠ¨å›åˆç®¡ç†é€»è¾‘ï¼Œç®€åŒ– handleSelectSlot

**å®ç°ç»†èŠ‚**:
```javascript
// æœåŠ¡å™¨ç«¯
if (!player.canPlayExtra) {
  this.gameState.playerReady[playerId] = true
  const allReady = Object.values(this.gameState.playerReady).every(ready => ready)
  if (allReady) {
    this.gameState.message += ' | åŒæ–¹éƒ½å·²å®Œæˆï¼Œç­‰å¾…è¿›å…¥ä¸‹ä¸€å›åˆ...'
  }
}

// å®¢æˆ·ç«¯
if (newState.playerReady) {
  // åŒæ­¥æœåŠ¡å™¨çš„å‡†å¤‡çŠ¶æ€
  if (game.bothPlayersReady.value) {
    setTimeout(() => {
      if (newState.isFinalRound) {
        multiplayer.sendAction({ type: 'endGame' })
      } else {
        multiplayer.sendAction({ type: 'startNewRound' })
      }
    }, 2000)
  }
}
```

**æµ‹è¯•ç»“æœ**:
- âœ… åŒæ–¹å‡ºç‰Œåï¼Œè‡ªåŠ¨è¿›å…¥ä¸‹ä¸€å›åˆ
- âœ… å›åˆæ•°æ­£ç¡®é€’å¢
- âœ… æ¯å›åˆå¼€å§‹æ—¶æ­£ç¡®æŠ½ç‰Œ

---

#### ä¿®å¤20: ç­‰å¾…æç¤ºæ¢å¤
**é—®é¢˜**: 
- ç©å®¶å†³ç­–åæ²¡æœ‰"ç­‰å¾…å¯¹æ‰‹..."çš„æç¤º

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥å‘ç°æ¨¡æ¿ä¸­å·²æœ‰ç­‰å¾…æç¤ºï¼š`<div v-if="game.myDecisionMade.value && !game.opponentDecisionMade.value">`
- æç¤ºä¼šåœ¨ä»¥ä¸‹æƒ…å†µæ˜¾ç¤ºï¼š
  - ç©å®¶ç‚¹å‡»"å‡ºç‰Œ"æˆ–"é‡é“¸"å
  - å¯¹æ‰‹è¿˜æœªåšå‡ºå†³ç­–æ—¶
- æœåŠ¡å™¨ç«¯çš„æ¶ˆæ¯ä¹Ÿä¼šæ˜¾ç¤º"ç­‰å¾…å¯¹æ‰‹..."

**ä¿®æ”¹æ–‡ä»¶**:
- æ— éœ€ä¿®æ”¹ï¼ŒåŠŸèƒ½å·²å­˜åœ¨å¹¶æ­£å¸¸å·¥ä½œ

---

#### è°ƒè¯•æ—¥å¿—å¢å¼º
ä¸ºäº†å¿«é€Ÿå®šä½é—®é¢˜ï¼Œæ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—ï¼š

**æœåŠ¡å™¨ç«¯**:
- `handleChoosePlay` å’Œ `handleChooseReforge` ä¸­æ·»åŠ å†³ç­–çŠ¶æ€æ—¥å¿—
- `handlePlayCard` ä¸­æ·»åŠ å‡†å¤‡çŠ¶æ€æ—¥å¿—
- `gameAction` äº‹ä»¶ä¸­æ·»åŠ è¯¦ç»†çš„æ“ä½œæ—¥å¿—

**å®¢æˆ·ç«¯**:
- `handleGameStateUpdate` ä¸­æ·»åŠ å®Œæ•´çš„çŠ¶æ€æ—¥å¿—
- `choosePlay` å’Œ `chooseReforge` ä¸­æ·»åŠ æ“ä½œæ—¥å¿—
- `handleOpponentDecision` å’Œ `resetDecisionState` ä¸­æ·»åŠ çŠ¶æ€å˜åŒ–æ—¥å¿—

**ä¿®æ”¹æ–‡ä»¶**:
- `server/gameEngine.js` - æ·»åŠ è¯¦ç»†æ—¥å¿—
- `server/index.js` - æ·»åŠ æ“ä½œæ—¥å¿—
- `src/views/Game/CardGameMultiplayer.vue` - æ·»åŠ çŠ¶æ€æ—¥å¿—
- `src/composables/useGameClient.ts` - æ·»åŠ æ“ä½œæ—¥å¿—

---

#### æŠ€æœ¯è¦ç‚¹æ€»ç»“

**ç‹¬ç«‹å†³ç­–ç³»ç»Ÿçš„å…³é”®**:
1. æœåŠ¡å™¨ç«¯ç»´æŠ¤æ¯ä¸ªç©å®¶çš„ç‹¬ç«‹å†³ç­–çŠ¶æ€
2. å…¨å±€ `phase` åªåœ¨æ‰€æœ‰ç©å®¶éƒ½å†³ç­–åæ‰æ”¹å˜
3. å®¢æˆ·ç«¯ä¸æ ¹æ® `phase` æ¨æ–­å¯¹æ‰‹çŠ¶æ€ï¼Œè€Œæ˜¯ç­‰å¾…æœåŠ¡å™¨æ˜ç¡®é€šçŸ¥

**è‡ªåŠ¨å›åˆç®¡ç†çš„å…³é”®**:
1. æœåŠ¡å™¨ç«¯è·Ÿè¸ªæ¯ä¸ªç©å®¶çš„å‡†å¤‡çŠ¶æ€
2. ç©å®¶å‡ºç‰Œåè‡ªåŠ¨æ ‡è®°ä¸ºå‡†å¤‡å®Œæˆ
3. å®¢æˆ·ç«¯æ£€æµ‹åˆ°åŒæ–¹éƒ½å‡†å¤‡å¥½åï¼Œè‡ªåŠ¨å‘é€å›åˆè¯·æ±‚
4. æ–°å›åˆå¼€å§‹æ—¶é‡ç½®æ‰€æœ‰çŠ¶æ€

**çŠ¶æ€åŒæ­¥çš„åŸåˆ™**:
1. æœåŠ¡å™¨æ˜¯å”¯ä¸€çš„çœŸç›¸æº
2. å®¢æˆ·ç«¯åªè´Ÿè´£æ˜¾ç¤ºå’Œå‘é€è¯·æ±‚
3. æ‰€æœ‰æ¸¸æˆé€»è¾‘åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œ
4. å®¢æˆ·ç«¯é€šè¿‡æœåŠ¡å™¨å¹¿æ’­çš„çŠ¶æ€æ›´æ–°æ¥åŒæ­¥

---

#### ä¿®å¤26: ç»Ÿä¸€å¡ç‰Œéšè—æœºåˆ¶ï¼ˆ2026å¹´2æœˆ11æ—¥ 20:02ï¼‰

**é—®é¢˜**ï¼šä¹‹å‰çš„éšè—é€»è¾‘è¿‡äºå¤æ‚ï¼Œå¯¼è‡´ç©å®¶é¡ºåºæ··ä¹±

**æ–°æ–¹æ¡ˆ**ï¼š
- éšè—æ‰€æœ‰ç©å®¶çš„å¾…æ­ç¤ºå¡ç‰Œï¼ˆä¸åŒºåˆ†è‡ªå·±å’Œå¯¹æ‰‹ï¼‰
- æ‰€æœ‰ç©å®¶çš„å¾…æ­ç¤ºå¡ç‰Œéƒ½æ˜¾ç¤ºä¸º"ï¼Ÿï¼Ÿï¼Ÿ"
- æ‰€æœ‰ç©å®¶çš„è´¹ç”¨å˜åŒ–éƒ½è¢«éšè—
- å›åˆç»“æŸæ—¶ç»Ÿä¸€æ­ç¤ºæ‰€æœ‰å¡ç‰Œ
- æ­ç¤ºæ—¶è´¹ç”¨å’Œæˆ˜åŠ›åŒæ—¶æ›´æ–°

**å®ç°é€»è¾‘**ï¼š
1. éå†æ‰€æœ‰ç©å®¶çš„ `pendingReveals`
2. éšè—æ¯ä¸ªç©å®¶åœºä¸Šçš„å¾…æ­ç¤ºå¡ç‰Œ
3. æ¢å¤æ¯ä¸ªç©å®¶å·²èŠ±è´¹ä½†æœªæ­ç¤ºçš„è´¹ç”¨
4. åŒæ–¹éƒ½å‡†å¤‡å¥½åï¼Œè°ƒç”¨ `revealAllCards()` æ¸…ç©ºå¾…æ­ç¤ºåˆ—è¡¨
5. æ¸…ç©ºåï¼Œæ‰€æœ‰å¡ç‰Œè‡ªç„¶æ˜¾ç¤ºï¼Œè´¹ç”¨å’Œæˆ˜åŠ›åŒæ—¶æ›´æ–°

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `server/gameEngine.js` - getPlayerGameState

---

#### ä¿®å¤27: å¡ç‰Œæ­ç¤ºæ—¶æœºä¿®æ­£ï¼ˆ2026å¹´2æœˆ11æ—¥ 20:10ï¼‰

**é—®é¢˜**ï¼šå¡ç‰Œåœ¨åŒæ–¹å‡†å¤‡å¥½æ—¶ç«‹å³æ­ç¤ºï¼Œå¯¼è‡´å®¢æˆ·ç«¯çœ‹åˆ°å·²æ­ç¤ºçš„çŠ¶æ€

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å°† `revealAllCards()` è°ƒç”¨ä»åŒæ–¹å‡†å¤‡å¥½æ—¶ç§»åˆ° `startNewRound()` å¼€å§‹æ—¶
- åœ¨æ–°å›åˆå¼€å§‹å‰å…ˆæ­ç¤ºä¸Šä¸€å›åˆçš„æ‰€æœ‰å¡ç‰Œ
- ç¡®ä¿æ­ç¤ºå‘ç”Ÿåœ¨å›åˆåˆ‡æ¢æ—¶ï¼Œè€Œä¸æ˜¯å‡†å¤‡å®Œæˆæ—¶

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `server/gameEngine.js` - startNewRound æ–¹æ³•å¼€å§‹æ—¶è°ƒç”¨ revealAllCards()

---

#### ä¿®å¤28: æ·±æ‹·è´åœºåœ°çŠ¶æ€é¿å…æ±¡æŸ“åŸå§‹æ•°æ®ï¼ˆ2026å¹´2æœˆ11æ—¥ 20:13ï¼‰

**é—®é¢˜**ï¼šå¡ç‰Œéšè—åæ— æ³•æ­ç¤ºï¼Œå› ä¸º `getPlayerGameState` ä½¿ç”¨æµ…æ‹·è´ï¼Œä¿®æ”¹äº†åŸå§‹ `gameState` ä¸­çš„å¡ç‰Œå¯¹è±¡

**æ ¹æœ¬åŸå› **ï¼š
- `getPublicGameState()` ä½¿ç”¨ `...player` æµ…æ‹·è´ï¼Œ`field` æ•°ç»„å’Œ `slot` å¯¹è±¡éƒ½æ˜¯å¼•ç”¨
- åœ¨ `getPlayerGameState` ä¸­ä¿®æ”¹ `slot.card` æ—¶ï¼Œå®é™…ä¿®æ”¹äº†åŸå§‹çŠ¶æ€
- å¯¼è‡´åŸå§‹ `gameState` ä¸­çš„å¡ç‰Œè¢«æ›¿æ¢ä¸ºå ä½ç¬¦ `{ name: 'ï¼Ÿï¼Ÿï¼Ÿ' }`
- å³ä½¿ `revealAllCards()` æ¸…ç©ºäº†å¾…æ­ç¤ºåˆ—è¡¨ï¼Œå¡ç‰Œå¯¹è±¡æœ¬èº«å·²ç»è¢«ç ´å

**è§£å†³æ–¹æ¡ˆ**ï¼š
- åœ¨éšè—å¡ç‰Œä¹‹å‰ï¼Œæ·±æ‹·è´æ‰€æœ‰ç©å®¶çš„ `field` æ•°ç»„å’Œ `slot` å¯¹è±¡
- ç¡®ä¿ä¿®æ”¹åªå½±å“å‘é€ç»™å®¢æˆ·ç«¯çš„å‰¯æœ¬ï¼Œä¸å½±å“æœåŠ¡å™¨çš„åŸå§‹çŠ¶æ€
- è¿™æ · `revealAllCards()` æ¸…ç©ºåˆ—è¡¨åï¼ŒåŸå§‹å¡ç‰Œæ•°æ®å®Œå¥½æ— æŸ

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `server/gameEngine.js` - getPlayerGameState æ–¹æ³•æ·»åŠ æ·±æ‹·è´é€»è¾‘

---

#### ä¿®å¤29: å›åˆé‡å¤å‰è¿›é—®é¢˜ï¼ˆ2026å¹´2æœˆ11æ—¥ 20:20-20:25ï¼‰

**é—®é¢˜**ï¼šæ¯å›åˆç»“æŸåå›åˆæ•°è·³è·ƒï¼ˆ1â†’3â†’5â†’7ï¼‰ï¼Œæ¯å›åˆæŠ½2å¼ ç‰Œ

**æ ¹æœ¬åŸå› **ï¼š
- ä¸¤ä¸ªç©å®¶éƒ½ä¼šå‘é€ `startNewRound` è¯·æ±‚
- `handleGameStateUpdate` ä¸­æ£€æµ‹åˆ°åŒæ–¹å‡†å¤‡å¥½æ—¶å‘é€ä¸€æ¬¡
- `handleSkipTurn` ä¸­æ£€æµ‹åˆ°åŒæ–¹å‡†å¤‡å¥½æ—¶åˆå‘é€ä¸€æ¬¡
- å¯¼è‡´æœåŠ¡å™¨æ”¶åˆ°ä¸¤æ¬¡è¯·æ±‚ï¼Œå›åˆå‰è¿›ä¸¤æ¬¡

**ç¬¬ä¸€æ¬¡å°è¯•ï¼ˆå¤±è´¥ï¼‰**ï¼š
- å°è¯•ä½¿ç”¨ `players[0]` æ¥åˆ¤æ–­è°å‘é€è¯·æ±‚
- ä½†æœåŠ¡å™¨çš„ `getPlayerGameState` ä¼šäº¤æ¢ç©å®¶é¡ºåº
- å¯¼è‡´ä¸¤ä¸ªç©å®¶éƒ½è®¤ä¸ºè‡ªå·±æ˜¯ `players[0]`

**æœ€ç»ˆè§£å†³æ–¹æ¡ˆ**ï¼š
1. ä½¿ç”¨ç©å®¶IDçš„å­—å…¸åºæ¥å†³å®šè°å‘é€è¯·æ±‚
2. è·å– `playerReady` å¯¹è±¡çš„æ‰€æœ‰é”®ï¼ˆç©å®¶IDï¼‰å¹¶æ’åº
3. åªæœ‰IDæœ€å°çš„ç©å®¶å‘é€ `startNewRound` è¯·æ±‚
4. ç§»é™¤ `handleSkipTurn` ä¸­çš„é‡å¤é€»è¾‘

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `src/views/Game/CardGameMultiplayer.vue` - handleGameStateUpdate å’Œ handleSkipTurn

---

#### ä¿®å¤30: è·³è¿‡å›åˆåŠŸèƒ½å¤±æ•ˆï¼ˆ2026å¹´2æœˆ11æ—¥ 20:30ï¼‰

**é—®é¢˜**ï¼šç©å®¶ç‚¹å‡»"è·³è¿‡å›åˆ"æŒ‰é’®åæ²¡æœ‰ååº”ï¼Œå›åˆæ— æ³•ç»§ç»­

**æ ¹æœ¬åŸå› **ï¼š
- å®¢æˆ·ç«¯çš„ `handleSkipTurn` åªåœ¨æœ¬åœ°è°ƒç”¨äº† `game.setMyReady()`
- æ²¡æœ‰é€šçŸ¥æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨çš„ `playerReady` çŠ¶æ€æœªæ›´æ–°
- å¯¼è‡´æœåŠ¡å™¨è®¤ä¸ºç©å®¶è¿˜æœªå‡†å¤‡å®Œæˆ

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. åœ¨æœåŠ¡å™¨ç«¯æ·»åŠ  `handleSkipTurn` æ–¹æ³•ï¼Œæ ‡è®°ç©å®¶ä¸ºå‡†å¤‡å®Œæˆ
2. åœ¨ `server/index.js` çš„ `gameAction` å¤„ç†ä¸­æ·»åŠ  `skipTurn` case
3. ä¿®æ”¹å®¢æˆ·ç«¯çš„ `handleSkipTurn`ï¼Œå‘é€ `skipTurn` æ“ä½œåˆ°æœåŠ¡å™¨

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `server/gameEngine.js` - æ·»åŠ  handleSkipTurn æ–¹æ³•
- `server/index.js` - æ·»åŠ  skipTurn case
- `src/views/Game/CardGameMultiplayer.vue` - ä¿®æ”¹ handleSkipTurn å‘é€æ“ä½œ

---

#### ä¿®å¤31: é¢å¤–æ§½ä½æ•ˆæœä¿®å¤ï¼ˆ2026å¹´2æœˆ11æ—¥ 20:35-20:45ï¼‰

**é—®é¢˜**ï¼šé©®ç”¨é©¬å’Œç‹®é¹«çš„é¢å¤–æ§½ä½æ•ˆæœæ²¡æœ‰ç”Ÿæ•ˆ

**è°ƒè¯•è¿‡ç¨‹**ï¼š
1. æ·»åŠ è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºåˆ° `triggerDeployEffects` å’Œ `createExtraSlot` æ–¹æ³•
2. æœåŠ¡å™¨æ—¥å¿—æ˜¾ç¤ºé¢å¤–æ§½ä½**ç¡®å®è¢«åˆ›å»ºäº†**ï¼š
   ```
   [GameEngine] è§¦å‘åˆ›å»ºé¢å¤–æ§½ä½æ•ˆæœ
   [GameEngine] createExtraSlot: çˆ¶å¡ç‰Œ=é©®ç”¨é©¬, çˆ¶æ§½ä½ç´¢å¼•=0
   [GameEngine] åˆ›å»ºäº†é¢å¤–æ§½ä½ï¼Œæ–°æ§½ä½ä½ç½®=6ï¼Œå½“å‰æ€»æ§½ä½æ•°=7
   ```
3. é—®é¢˜å®šä½ï¼šæœåŠ¡å™¨ç«¯é€»è¾‘æ­£ç¡®ï¼Œä½†å®¢æˆ·ç«¯æ²¡æœ‰æ˜¾ç¤ºé¢å¤–æ§½ä½

**æ ¹æœ¬åŸå› **ï¼š
- å®¢æˆ·ç«¯æ¨¡æ¿ä½¿ç”¨äº† `.filter((s: any) => !s.isExtra)` è¿‡æ»¤æ‰äº†æ‰€æœ‰é¢å¤–æ§½ä½
- å¯¼è‡´å³ä½¿æœåŠ¡å™¨åˆ›å»ºäº†é¢å¤–æ§½ä½ï¼Œå®¢æˆ·ç«¯ä¹Ÿä¸æ˜¾ç¤º

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç§»é™¤æ¨¡æ¿ä¸­çš„ `.filter((s: any) => !s.isExtra)`ï¼Œæ˜¾ç¤ºæ‰€æœ‰æ§½ä½
2. æ·»åŠ  `extra-slot` CSS ç±»æ¥åŒºåˆ†é¢å¤–æ§½ä½
3. é¢å¤–æ§½ä½ä½¿ç”¨è™šçº¿è¾¹æ¡†å’Œé‡‘è‰²èƒŒæ™¯
4. ç©ºçš„é¢å¤–æ§½ä½æ˜¾ç¤º"é¢å¤–"è€Œä¸æ˜¯æ•°å­—

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `server/gameEngine.js` - æ·»åŠ è°ƒè¯•æ—¥å¿—å’Œå®‰å…¨æ£€æŸ¥
- `src/views/Game/CardGameMultiplayer.vue` - ç§»é™¤è¿‡æ»¤å™¨ï¼Œæ˜¾ç¤ºæ‰€æœ‰æ§½ä½ï¼Œæ·»åŠ æ ·å¼

**çŠ¶æ€**ï¼šå·²ä¿®å¤

---

## ç¬¬åä¸€é˜¶æ®µï¼šSakura FRP äº’è”ç½‘è”æœºåŠŸèƒ½æ£€æŸ¥ï¼ˆ2026å¹´2æœˆ11æ—¥ 20:50ï¼‰

### åŠŸèƒ½çŠ¶æ€æ£€æŸ¥

**å·²å®ç°çš„åŠŸèƒ½**ï¼š
1. âœ… æœåŠ¡å™¨é…ç½®ç³»ç»Ÿï¼ˆ`src/config/multiplayer.ts`ï¼‰
2. âœ… æœåŠ¡å™¨é…ç½®å¯¹è¯æ¡†ï¼ˆ`src/views/Game/ServerConfigDialog.vue`ï¼‰
3. âœ… å¤šç§è¿æ¥æ¨¡å¼æ”¯æŒï¼ˆæœ¬åœ°/å±€åŸŸç½‘/FRP/è‡ªå®šä¹‰ï¼‰
4. âœ… é…ç½®æŒä¹…åŒ–ï¼ˆlocalStorageï¼‰
5. âœ… è‡ªåŠ¨æ¨¡å¼æ£€æµ‹ï¼ˆæ ¹æ®è®¿é—®åŸŸåè‡ªåŠ¨é€‰æ‹©ï¼‰
6. âœ… å®Œæ•´çš„ FRP é…ç½®æŒ‡å—ï¼ˆ`SAKURA_FRP_GUIDE.md`ï¼‰

**é…ç½®æ–‡ä»¶çŠ¶æ€**ï¼š
- `src/config/multiplayer.ts` - å®Œæ•´å®ç°ï¼Œæ”¯æŒå¤šç§æ¨¡å¼
- `src/views/Game/ServerConfigDialog.vue` - UIå®Œæ•´ï¼ŒåŒ…å«FRPé…ç½®æç¤º
- `SAKURA_FRP_GUIDE.md` - è¯¦ç»†çš„é…ç½®æŒ‡å—å’Œæ•…éšœæ’é™¤

**éœ€è¦ç”¨æˆ·é…ç½®çš„éƒ¨åˆ†**ï¼š
1. åœ¨ Sakura FRP å®˜ç½‘åˆ›å»ºä¸¤ä¸ªéš§é“ï¼š
   - åç«¯éš§é“ï¼šTCPç±»å‹ï¼Œæœ¬åœ°ç«¯å£ 3001
   - å‰ç«¯éš§é“ï¼šHTTPç±»å‹ï¼Œæœ¬åœ°ç«¯å£ 5173
2. å¯åŠ¨ Sakura FRP å®¢æˆ·ç«¯
3. æ›´æ–° `src/config/multiplayer.ts` ä¸­çš„ `SERVER_CONFIG.frp` ä¸ºå®é™…çš„FRPåœ°å€
4. æˆ–åœ¨æ¸¸æˆä¸­é€šè¿‡"æœåŠ¡å™¨é…ç½®"å¯¹è¯æ¡†è¾“å…¥FRPåœ°å€

### ä½¿ç”¨æµç¨‹

**ä¸»æœºç«¯ï¼ˆä½ ï¼‰**ï¼š
1. å¯åŠ¨æœ¬åœ°æœåŠ¡ï¼ˆå‰ç«¯+åç«¯ï¼‰
2. å¯åŠ¨ Sakura FRP éš§é“ï¼ˆå‰ç«¯+åç«¯ï¼‰
3. è®¿é—® FRP åˆ†é…çš„å‰ç«¯åœ°å€
4. åœ¨è”æœºå¤§å…é€‰æ‹©"Sakura FRP"æ¨¡å¼æˆ–æ‰‹åŠ¨é…ç½®
5. åˆ›å»ºæˆ¿é—´ï¼Œè®°ä½æˆ¿é—´ID
6. åˆ†äº«å‰ç«¯åœ°å€å’Œæˆ¿é—´IDç»™æœ‹å‹

**å®¢æˆ·ç«¯ï¼ˆæœ‹å‹ï¼‰**ï¼š
1. è®¿é—®ä½ åˆ†äº«çš„å‰ç«¯åœ°å€
2. åº”è¯¥è‡ªåŠ¨è¿æ¥åˆ°FRPåç«¯
3. åŠ å…¥æˆ¿é—´ï¼ˆè¾“å…¥æˆ¿é—´IDï¼‰
4. å¼€å§‹æ¸¸æˆ

### é…ç½®ç¤ºä¾‹

**Sakura FRP éš§é“é…ç½®**ï¼š
```
éš§é“1ï¼ˆåç«¯ï¼‰ï¼š
- åç§°ï¼šcard-game-backend
- ç±»å‹ï¼šTCP
- æœ¬åœ°åœ°å€ï¼š127.0.0.1:3001
- èŠ‚ç‚¹ï¼šé€‰æ‹©å»¶è¿Ÿä½çš„èŠ‚ç‚¹
- è¿œç¨‹ç«¯å£ï¼šè‡ªåŠ¨åˆ†é…ï¼ˆä¾‹å¦‚ï¼š12345ï¼‰
- ç»“æœï¼šcn-sh-bgp-1.natfrp.cloud:12345

éš§é“2ï¼ˆå‰ç«¯ï¼‰ï¼š
- åç§°ï¼šcard-game-frontend
- ç±»å‹ï¼šHTTP
- æœ¬åœ°åœ°å€ï¼š127.0.0.1:5173
- èŠ‚ç‚¹ï¼šåŒåç«¯èŠ‚ç‚¹
- åŸŸåï¼šè‡ªåŠ¨åˆ†é…
- ç»“æœï¼šabc123.natfrp.cloud
```

**é…ç½®æ–‡ä»¶æ›´æ–°**ï¼š
```typescript
// src/config/multiplayer.ts
export const SERVER_CONFIG = {
  local: 'http://localhost:3001',
  lan: 'http://192.168.1.7:3001',
  frp: 'http://cn-sh-bgp-1.natfrp.cloud:12345', // æ›´æ–°ä¸ºå®é™…åœ°å€
  internet: 'https://your-server.com:3001'
}
```

### æµ‹è¯•æ­¥éª¤

1. **æœ¬åœ°æµ‹è¯•**ï¼š
   ```bash
   # å¯åŠ¨åç«¯
   cd server && node index.js
   
   # å¯åŠ¨å‰ç«¯
   pnpm run dev
   ```

2. **å¯åŠ¨ FRP éš§é“**ï¼š
   - æ‰“å¼€ Sakura FRP å¯åŠ¨å™¨
   - å¯åŠ¨ä¸¤ä¸ªéš§é“
   - ç¡®è®¤çŠ¶æ€ä¸º"è¿è¡Œä¸­"

3. **è®¿é—®æµ‹è¯•**ï¼š
   - è®¿é—® FRP å‰ç«¯åœ°å€
   - æ£€æŸ¥è¿æ¥çŠ¶æ€ï¼ˆåº”æ˜¾ç¤º"å·²è¿æ¥"ï¼‰
   - åˆ›å»ºæˆ¿é—´æµ‹è¯•

4. **è¿œç¨‹æµ‹è¯•**ï¼š
   - è®©æœ‹å‹è®¿é—® FRP å‰ç«¯åœ°å€
   - åŠ å…¥æˆ¿é—´
   - å¼€å§‹æ¸¸æˆ

### å¸¸è§é—®é¢˜

**Q: æ˜¾ç¤º"æœªè¿æ¥"ï¼Ÿ**
- æ£€æŸ¥ FRP éš§é“æ˜¯å¦è¿è¡Œ
- æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ
- æ£€æŸ¥é…ç½®çš„åœ°å€æ˜¯å¦æ­£ç¡®

**Q: WebSocket è¿æ¥å¤±è´¥ï¼Ÿ**
- åç«¯éš§é“ä½¿ç”¨ TCP ç±»å‹ï¼ˆæ¨èï¼‰
- æˆ–ç¡®ä¿ HTTP éš§é“æ”¯æŒ WebSocket å‡çº§

**Q: å¦‚ä½•æŸ¥çœ‹ FRP æ—¥å¿—ï¼Ÿ**
- åœ¨ Sakura FRP å¯åŠ¨å™¨ä¸­å³é”®éš§é“ â†’ æŸ¥çœ‹æ—¥å¿—

### ä¸‹ä¸€æ­¥å·¥ä½œ

å¦‚æœéœ€è¦éƒ¨ç½²åˆ°çœŸæ­£çš„äº’è”ç½‘æœåŠ¡å™¨ï¼š
1. ç§Ÿç”¨äº‘æœåŠ¡å™¨ï¼ˆé˜¿é‡Œäº‘/è…¾è®¯äº‘/AWSç­‰ï¼‰
2. éƒ¨ç½²åç«¯æœåŠ¡
3. é…ç½®åŸŸåå’ŒSSLè¯ä¹¦
4. æ›´æ–° `SERVER_CONFIG.internet` é…ç½®

**çŠ¶æ€**ï¼šSakura FRP åŠŸèƒ½å®Œæ•´ï¼Œéœ€è¦ç”¨æˆ·é…ç½®å®é™…çš„ FRP éš§é“åœ°å€

---

**æŠ€æœ¯è¦ç‚¹**:

**å¡ç‰ŒåŒæ—¶æ­ç¤ºçš„å…³é”®**:
1. æœåŠ¡å™¨ç«¯ç»´æŠ¤å¾…æ­ç¤ºåˆ—è¡¨ï¼Œè·Ÿè¸ªæ¯ä¸ªç©å®¶æ‰“å‡ºä½†æœªæ­ç¤ºçš„å¡ç‰Œ
2. åœ¨å‘é€ç»™å¯¹æ‰‹çš„æ¸¸æˆçŠ¶æ€ä¸­ï¼Œå°†å¾…æ­ç¤ºçš„å¡ç‰Œæ›¿æ¢ä¸ºå ä½ç¬¦
3. æ–°å›åˆå¼€å§‹æ—¶ï¼Œå…ˆæ­ç¤ºä¸Šä¸€å›åˆçš„æ‰€æœ‰å¡ç‰Œ
4. æ­ç¤ºåï¼Œå¡ç‰Œè‡ªç„¶æ˜¾ç¤ºï¼Œè´¹ç”¨å’Œæˆ˜åŠ›åŒæ—¶æ›´æ–°

**æœ€åä¸€å›åˆçš„å…³é”®**:
1. è®°å½•è§¦å‘æœ€åä¸€å›åˆçš„å›åˆæ•°
2. æ¯æ¬¡å¼€å§‹æ–°å›åˆæ—¶æ£€æŸ¥æ˜¯å¦å·²ç»è¿‡äº†ä¸€ä¸ªå®Œæ•´å›åˆ
3. æœåŠ¡å™¨ç«¯ç»Ÿä¸€æ§åˆ¶æ¸¸æˆç»“æŸæ—¶æœº

---

**æµ‹è¯•è¦ç‚¹**:
1. âœ… åˆ·æ–°é¡µé¢åï¼Œç»ˆç«¯åº”æ˜¾ç¤ºç›¸åŒçš„ persistentPlayerId
2. âœ… åˆ›å»ºæˆ¿é—´ååˆ·æ–°ï¼Œåº”è¯¥èƒ½é€šè¿‡æˆ¿é—´IDé‡æ–°åŠ å…¥
3. âœ… ç©å®¶Aé€‰æ‹©"å‡ºç‰Œ"ï¼Œç©å®¶Båº”è¯¥åœç•™åœ¨å†³ç­–é˜¶æ®µï¼Œå¯ä»¥ç‹¬ç«‹é€‰æ‹©
4. âœ… ä¸€ä¸ªç©å®¶ç¦»å¼€åï¼Œå¦ä¸€ä¸ªç©å®¶åº”è¯¥èƒ½çœ‹åˆ°"æ¸¸æˆä¸­1/2"
5. âœ… ç¦»å¼€çš„ç©å®¶åˆ·æ–°é¡µé¢åï¼Œåº”è¯¥èƒ½é€šè¿‡è¾“å…¥æˆ¿é—´IDé‡æ–°åŠ å…¥

---

### ç¬¬åé˜¶æ®µï¼šæœ€ç»ˆè°ƒè¯•ï¼ˆ2026å¹´2æœˆ7æ—¥ 21:51ï¼‰

#### é—®é¢˜åé¦ˆï¼ˆç¬¬ä¸‰è½®æµ‹è¯•ï¼‰
ç”¨æˆ·ä½¿ç”¨ QQæµè§ˆå™¨ + Chromeæ— ç—•æ¨¡å¼æµ‹è¯•ï¼Œä½†é—®é¢˜ä¾ç„¶å­˜åœ¨ï¼š

**å…³é”®å‘ç°**ï¼š
ä»æ—¥å¿—çœ‹ï¼Œä¸¤ä¸ªæµè§ˆå™¨çš„ `persistentPlayerId` å’Œ `tabId` å®Œå…¨ç›¸åŒï¼š
- `persistentPlayerId: player_1770468259097_ldsnavh1n`
- `tabId: tab_1770471904440_jdidjnyjs`

**ç»“è®º**ï¼šQQæµè§ˆå™¨å’ŒChromeå¯èƒ½å…±äº«äº† localStorageï¼è¿™å¯¼è‡´å®ƒä»¬è¢«è¯†åˆ«ä¸ºåŒä¸€ä¸ªç©å®¶ã€‚

#### é—®é¢˜1: æ“ä½œç»‘å®šçš„ç²¾ç¡®å®šä½
**ç”¨æˆ·è§‚å¯Ÿ**ï¼š
- ç©å®¶Aç‚¹å‡»"å‡ºç‰Œ"æŒ‰é’® â†’ ç©å®¶Bä¸å—å½±å“ âœ…
- ç©å®¶Aé€‰æ‹©æ‰‹ç‰Œ â†’ ç©å®¶Bä¸å—å½±å“ âœ…
- **ç©å®¶Aç‚¹å‡»åœºä¸Šæ ¼å­** â†’ ç©å®¶Bä¹Ÿè¿›å…¥å‡ºç‰Œé˜¶æ®µ âŒ

**æ ¹æœ¬åŸå› **ï¼š
`selectSlotToPlay` â†’ `playCardToSlot` â†’ `deployCard` è¿™ä¸ªè°ƒç”¨é“¾ä¼šä¿®æ”¹ `gameState.phase`

#### ä¿®å¤18: PhaseçŠ¶æ€éš”ç¦»
**è§£å†³æ–¹æ¡ˆ**ï¼š
åœ¨ `selectSlotToPlay` ä¸­ï¼Œæ‰“å‡ºå¡ç‰Œåç«‹å³é‡ç½® `phase` å›åˆ° `'action'`ï¼Œé¿å…å½±å“å¯¹æ‰‹

**ä¿®æ”¹æ–‡ä»¶**:
- `src/composables/useGameMultiplayer.ts`

---

#### é—®é¢˜2: æ¸¸æˆçŠ¶æ€åŒæ­¥å¤±è´¥
**é—®é¢˜**ï¼š
- æœåŠ¡å™¨ç«¯ä¿å­˜äº† `actionHistory`
- é‡è¿æ—¶å‘é€äº†æ“ä½œå†å²
- ä½†å®¢æˆ·ç«¯æ²¡æœ‰æ­£ç¡®å›æ”¾

**åŸå› åˆ†æ**ï¼š
1. `roomRejoined` äº‹ä»¶ä¸­å°è¯•å›æ”¾æ“ä½œ
2. ä½†ä½¿ç”¨äº† `socket.emit('replayAction')` - è¿™ä¸ªäº‹ä»¶æœåŠ¡å™¨ç«¯ä¸å­˜åœ¨
3. åº”è¯¥ç›´æ¥è°ƒç”¨ `applyOpponentAction`

**å¾…ä¿®å¤**ï¼šéœ€è¦é‡æ–°è®¾è®¡æ¸¸æˆçŠ¶æ€åŒæ­¥æœºåˆ¶

---

## âš ï¸ å…³é”®é—®é¢˜ï¼šæµè§ˆå™¨æ•°æ®å…±äº«

**å‘ç°**ï¼šQQæµè§ˆå™¨å’ŒChromeå¯èƒ½å…±äº« localStorageï¼ˆå¯èƒ½é€šè¿‡æŸäº›åŒæ­¥æœºåˆ¶ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. **æ–¹æ¡ˆA**ï¼šä½¿ç”¨å®Œå…¨ä¸åŒçš„è®¾å¤‡ï¼ˆä¸¤å°ç”µè„‘/æ‰‹æœºï¼‰
2. **æ–¹æ¡ˆB**ï¼šæ‰‹åŠ¨æ¸…é™¤ localStorage åæµ‹è¯•
3. **æ–¹æ¡ˆC**ï¼šä½¿ç”¨ Firefox + Chromeï¼ˆå®Œå…¨ç‹¬ç«‹çš„æµè§ˆå™¨ï¼‰

**æ¸…é™¤ localStorage æ­¥éª¤**ï¼š
1. æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰
2. åˆ‡æ¢åˆ° Console æ ‡ç­¾
3. è¾“å…¥ï¼š`localStorage.clear()`
4. å›è½¦
5. åˆ·æ–°é¡µé¢

---

### ç¬¬åä¸€é˜¶æ®µï¼šå¼ºåˆ¶åŒæ­¥å†³ç­–æœºåˆ¶ï¼ˆ2026å¹´2æœˆ11æ—¥ 13:00ï¼‰

#### é—®é¢˜å›é¡¾
ç»è¿‡å¤šæ¬¡ä¿®å¤ï¼Œæ“ä½œç»‘å®šé—®é¢˜ä¾ç„¶å­˜åœ¨ï¼š
- ç©å®¶Aç‚¹å‡»"å‡ºç‰Œ"æŒ‰é’® â†’ ç©å®¶Bä¸å—å½±å“ âœ…
- ç©å®¶Aé€‰æ‹©æ‰‹ç‰Œ â†’ ç©å®¶Bä¸å—å½±å“ âœ…
- **ç©å®¶Aç‚¹å‡»åœºä¸Šæ ¼å­éƒ¨ç½²å•ä½ â†’ ç©å®¶Bä¹Ÿè‡ªåŠ¨è¿›å…¥å‡ºç‰Œé˜¶æ®µ** âŒ

**æ ¹æœ¬åŸå› åˆ†æ**ï¼š
- `gameState.phase` æ˜¯å…±äº«çŠ¶æ€
- ä¸€ä¸ªç©å®¶çš„æ“ä½œä¼šæ”¹å˜ phaseï¼Œå½±å“å¦ä¸€ä¸ªç©å®¶çš„UI
- ä¹‹å‰çš„ä¿®å¤éƒ½æ˜¯åœ¨ç—‡çŠ¶å±‚é¢ï¼Œæ²¡æœ‰ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜

#### ä¿®å¤19: å¼ºåˆ¶åŒæ­¥å†³ç­–é˜¶æ®µ
**æ–°æ–¹æ¡ˆ**ï¼š
ä¸å†è¯•å›¾éš”ç¦» phase çŠ¶æ€ï¼Œè€Œæ˜¯å¼ºåˆ¶åŒæ–¹å¿…é¡»åŒæ­¥å†³ç­–ï¼š
1. ç©å®¶é€‰æ‹©å‡ºç‰Œ/é‡é“¸åï¼Œå¿…é¡»ç­‰å¾…å¯¹æ‰‹ä¹Ÿåšå‡ºå†³ç­–
2. åªæœ‰åŒæ–¹éƒ½åšå‡ºå†³ç­–åï¼Œæ‰èƒ½é€‰æ‹©æ‰‹ç‰Œå’Œéƒ¨ç½²å•ä½
3. æ·»åŠ æ˜ç¡®çš„ç­‰å¾…æç¤ºUI

**å®ç°ç»†èŠ‚**ï¼š
1. æ·»åŠ  `myDecisionMade` å’Œ `opponentDecisionMade` ref è·Ÿè¸ªå†³ç­–çŠ¶æ€
2. æ·»åŠ  `bothDecisionsMade` computed æ£€æŸ¥åŒæ–¹æ˜¯å¦éƒ½å·²å†³ç­–
3. åœ¨ `handleOpponentAction` ä¸­ç›‘å¬å¯¹æ‰‹çš„ choosePlay/chooseReforge äº‹ä»¶
4. åœ¨ `onHandCardClick` ä¸­æ£€æŸ¥ `bothDecisionsMade`ï¼Œæœªæ»¡è¶³æ—¶æ˜¾ç¤ºç­‰å¾…æç¤º
5. åœ¨ `handleSelectSlot` ä¸­æ£€æŸ¥ `bothDecisionsMade`ï¼Œæœªæ»¡è¶³æ—¶æ˜¾ç¤ºç­‰å¾…æç¤º
6. åœ¨ `checkBothReady` ä¸­é‡ç½®å†³ç­–çŠ¶æ€ä¸º false
7. æ·»åŠ ç­‰å¾…å¯¹æ‰‹å†³ç­–çš„UIæç¤ºï¼ˆæ©™è‰²é—ªçƒï¼‰
8. æ·»åŠ åŒæ–¹å·²å†³ç­–çš„UIæç¤ºï¼ˆç»¿è‰²ï¼‰

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `src/views/Game/CardGameMultiplayer.vue` - æ·»åŠ å†³ç­–çŠ¶æ€ç®¡ç†å’ŒUIæç¤º
  - æ·»åŠ  `computed` å¯¼å…¥
  - æ·»åŠ  `myDecisionMade`, `opponentDecisionMade`, `bothDecisionsMade` çŠ¶æ€
  - ä¿®æ”¹ `handleOpponentAction` ç›‘å¬å¯¹æ‰‹å†³ç­–
  - ä¿®æ”¹ `handleChoosePlay` å’Œ `handleChooseReforge` æ·»åŠ ç­‰å¾…æç¤º
  - ä¿®æ”¹ `onHandCardClick` æ·»åŠ å†³ç­–æ£€æŸ¥
  - ä¿®æ”¹ `handleSelectSlot` æ·»åŠ å†³ç­–æ£€æŸ¥
  - ä¿®æ”¹ `checkBothReady` é‡ç½®å†³ç­–çŠ¶æ€
  - æ·»åŠ ç­‰å¾…å¯¹æ‰‹å’ŒåŒæ–¹å·²å†³ç­–çš„UIç»„ä»¶
  - æ·»åŠ å¯¹åº”çš„CSSæ ·å¼ï¼ˆé—ªçƒåŠ¨ç”»ï¼‰

**é¢„æœŸæ•ˆæœ**ï¼š
- ç©å®¶Aé€‰æ‹©"å‡ºç‰Œ"åï¼Œå¦‚æœç©å®¶Bè¿˜æ²¡å†³ç­–ï¼Œç©å®¶Aä¼šçœ‹åˆ°"ç­‰å¾…å¯¹æ‰‹åšå‡ºå†³ç­–..."
- ç©å®¶Aæ— æ³•é€‰æ‹©æ‰‹ç‰Œæˆ–éƒ¨ç½²å•ä½ï¼Œç›´åˆ°ç©å®¶Bä¹Ÿåšå‡ºå†³ç­–
- åŒæ–¹éƒ½å†³ç­–åï¼Œæ˜¾ç¤º"åŒæ–¹å·²å†³ç­–ï¼Œå¯ä»¥éƒ¨ç½²å•ä½äº†ï¼"
- è¿™æ ·å°±ä»æœºåˆ¶ä¸Šé¿å…äº†æ“ä½œç»‘å®šé—®é¢˜

**æµ‹è¯•è¦ç‚¹**ï¼š
1. ç©å®¶Aé€‰æ‹©"å‡ºç‰Œ"ï¼Œç©å®¶Båº”è¯¥ä»åœ¨å†³ç­–é˜¶æ®µ
2. ç©å®¶Aå°è¯•é€‰æ‹©æ‰‹ç‰Œï¼Œåº”è¯¥æ˜¾ç¤º"ç­‰å¾…å¯¹æ‰‹åšå‡ºå†³ç­–..."
3. ç©å®¶Bé€‰æ‹©"å‡ºç‰Œ"æˆ–"é‡é“¸"åï¼ŒåŒæ–¹éƒ½èƒ½æ­£å¸¸æ“ä½œ
4. å›åˆç»“æŸåï¼Œå†³ç­–çŠ¶æ€åº”è¯¥é‡ç½®

**çŠ¶æ€**ï¼šå·²å®ç°ï¼Œå¾…æµ‹è¯•

---

### ç¬¬åäºŒé˜¶æ®µï¼šæ¸¸æˆçŠ¶æ€åŒæ­¥ä¸é‡è¿æ¢å¤ï¼ˆ2026å¹´2æœˆ11æ—¥ 13:30 - 14:00ï¼‰

#### ä¿®å¤20: å®ç°å®Œæ•´æ¸¸æˆçŠ¶æ€ä¿å­˜ä¸æ¢å¤æœºåˆ¶

**é—®é¢˜åˆ†æ**ï¼š
æœ€åˆçš„æ–¹æ¡ˆæ˜¯é€šè¿‡å›æ”¾æ“ä½œå†å²æ¥æ¢å¤æ¸¸æˆçŠ¶æ€ï¼Œä½†è¿™ä¸ªæ–¹æ¡ˆæœ‰ä¸¥é‡ç¼ºé™·ï¼š
1. æ¯ä¸ªç©å®¶çš„ç‰Œç»„æ˜¯éšæœºçš„ï¼Œå›æ”¾æ— æ³•æ¢å¤æ‰‹ç‰Œ
2. éšæœºäº‹ä»¶ï¼ˆå¦‚æŠ½ç‰Œï¼‰æ— æ³•å‡†ç¡®é‡ç°
3. å›æ”¾è¿‡ç¨‹å¤æ‚ä¸”å®¹æ˜“å‡ºé”™

**æ›´å¥½çš„æ–¹æ¡ˆ**ï¼š
ç›´æ¥ä¿å­˜å’Œæ¢å¤å®Œæ•´çš„æ¸¸æˆçŠ¶æ€ï¼ˆ`gameState`ï¼‰

**å®ç°æ–¹æ¡ˆ**ï¼š

1. **æœåŠ¡å™¨ç«¯**ï¼š
   - æˆ¿é—´å¯¹è±¡å·²æœ‰ `gameState` å­—æ®µ
   - å·²æœ‰ `syncGameState` äº‹ä»¶æ¥æ”¶å®¢æˆ·ç«¯åŒæ­¥çš„çŠ¶æ€
   - ä¿®æ”¹ `rejoinRoom` å“åº”ï¼ŒåŒ…å«ä¿å­˜çš„ `gameState`

2. **å®¢æˆ·ç«¯åŒæ­¥**ï¼š
   - åœ¨æ¯æ¬¡å…³é”®æ“ä½œåè°ƒç”¨ `multiplayer.syncGameState(gameState.value)`
   - å…³é”®æ“ä½œåŒ…æ‹¬ï¼šæ‰“å‡ºå¡ç‰Œã€æ‰§è¡Œé‡é“¸ã€è·³è¿‡å›åˆç­‰
   - ç¡®ä¿æœåŠ¡å™¨ç«¯å§‹ç»ˆæœ‰æœ€æ–°çš„æ¸¸æˆçŠ¶æ€

3. **é‡è¿æ¢å¤**ï¼š
   - `useMultiplayer.ts` åœ¨æ”¶åˆ° `roomRejoined` æ—¶ä¿å­˜ `gameState` åˆ° sessionStorage
   - `CardGameMultiplayer.vue` åœ¨ `onMounted` æ—¶æ£€æŸ¥ sessionStorage
   - å¦‚æœæœ‰ä¿å­˜çš„çŠ¶æ€ï¼Œç›´æ¥æ¢å¤åˆ° `gameState.value`
   - æ¢å¤å†…å®¹åŒ…æ‹¬ï¼š
     * å›åˆæ•°ã€é˜¶æ®µã€æœ€åä¸€å›åˆæ ‡è®°
     * ç©å®¶è´¹ç”¨ã€æˆ˜åŠ›ã€åœºä¸Šå¡ç‰Œ
     * æ‰‹ç‰Œæ•°é‡ï¼ˆå¯¹æ‰‹ç”¨å ä½ç¬¦ï¼‰
     * å¼ƒç‰Œå †

**å®ç°ç»†èŠ‚**ï¼š

```typescript
// CardGameMultiplayer.vue - åŒæ­¥æ¸¸æˆçŠ¶æ€
function handleSelectSlot(slotIndex: number) {
  const action = selectSlotToPlay(slotIndex)
  if (action) {
    multiplayer.sendAction(action)
    multiplayer.syncGameState(gameState.value)  // åŒæ­¥çŠ¶æ€
  }
}

// CardGameMultiplayer.vue - æ¢å¤æ¸¸æˆçŠ¶æ€
onMounted(() => {
  initGame()
  
  const savedGameState = sessionStorage.getItem('savedGameState')
  if (savedGameState) {
    const restoredState = JSON.parse(savedGameState)
    
    // æ¢å¤å›åˆã€é˜¶æ®µç­‰
    gameState.value.round = restoredState.round
    gameState.value.phase = restoredState.phase
    
    // æ¢å¤ç©å®¶çŠ¶æ€
    // æ‰¾åˆ°è‡ªå·±å’Œå¯¹æ‰‹åœ¨ä¿å­˜çŠ¶æ€ä¸­çš„ç´¢å¼•
    const myIndex = restoredState.players.findIndex(p => p.id === myPlayerId)
    gameState.value.players[0].currentCost = restoredState.players[myIndex].currentCost
    gameState.value.players[0].field = restoredState.players[myIndex].field
    // ... æ¢å¤å…¶ä»–å­—æ®µ
    
    sessionStorage.removeItem('savedGameState')
  }
})
```

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `server/index.js` - åœ¨ `roomRejoined` å“åº”ä¸­åŒ…å« `gameState`
- `src/composables/useMultiplayer.ts` - ä¿å­˜ `gameState` åˆ° sessionStorage
- `src/views/Game/CardGameMultiplayer.vue` - åœ¨æ“ä½œååŒæ­¥çŠ¶æ€ï¼Œåœ¨æŒ‚è½½æ—¶æ¢å¤çŠ¶æ€

**ä¼˜åŠ¿**ï¼š
1. ç®€å•ç›´æ¥ï¼Œä¸éœ€è¦å¤æ‚çš„å›æ”¾é€»è¾‘
2. å‡†ç¡®å¯é ï¼Œå®Œå…¨æ¢å¤æ¸¸æˆçŠ¶æ€
3. æ€§èƒ½å¥½ï¼Œåªéœ€ä¸€æ¬¡çŠ¶æ€æ¢å¤

**æ³¨æ„äº‹é¡¹**ï¼š
1. æ‰‹ç‰Œå†…å®¹æ— æ³•æ¢å¤ï¼ˆå› ä¸ºå¯¹æ‰‹çœ‹ä¸åˆ°ï¼‰ï¼Œåªæ¢å¤æ•°é‡
2. ç‰Œç»„å†…å®¹æ— æ³•æ¢å¤ï¼Œä½†ä¸å½±å“æ¸¸æˆç»§ç»­
3. éœ€è¦åœ¨æ¯æ¬¡å…³é”®æ“ä½œååŒæ­¥çŠ¶æ€

**æµ‹è¯•è¦ç‚¹**ï¼š
1. åˆ›å»ºæˆ¿é—´ï¼ŒåŒæ–¹å„å‡ºå‡ å¼ ç‰Œ
2. å…¶ä¸­ä¸€æ–¹åˆ·æ–°é¡µé¢
3. åˆ·æ–°çš„ç©å®¶åº”è¯¥èƒ½çœ‹åˆ°ï¼š
   - æ­£ç¡®çš„å›åˆæ•°
   - åœºä¸Šå·²æœ‰çš„å¡ç‰Œï¼ˆä½ç½®ã€æˆ˜åŠ›æ­£ç¡®ï¼‰
   - æ­£ç¡®çš„è´¹ç”¨å’Œæˆ˜åŠ›
   - å¯¹æ‰‹çš„æ‰‹ç‰Œæ•°é‡
4. æ¸¸æˆå¯ä»¥ç»§ç»­æ­£å¸¸è¿›è¡Œ

**çŠ¶æ€**ï¼šå·²å®ç°ï¼Œå¾…æµ‹è¯•

---

### ç¬¬åä¸‰é˜¶æ®µï¼šæƒå¨æœåŠ¡å™¨æ¶æ„é‡æ„ï¼ˆ2026å¹´2æœˆ11æ—¥ 14:00 - 15:30ï¼‰

#### é‡å¤§æ¶æ„å˜æ›´ï¼šä»å®¢æˆ·ç«¯é€»è¾‘è¿ç§»åˆ°æƒå¨æœåŠ¡å™¨

**é—®é¢˜æ ¹æº**ï¼š
ç»è¿‡å¤šæ¬¡ä¿®å¤ï¼Œå‘ç°æ ¹æœ¬é—®é¢˜åœ¨äºæ¶æ„è®¾è®¡ï¼š
1. æ¸¸æˆé€»è¾‘åœ¨å®¢æˆ·ç«¯æ‰§è¡Œï¼Œæ¯ä¸ªå®¢æˆ·ç«¯å„è‡ªè®¡ç®—
2. æœåŠ¡å™¨åªè´Ÿè´£è½¬å‘æ“ä½œï¼Œä¸éªŒè¯ä¸è®¡ç®—
3. å¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´ã€è´¹ç”¨å¯ä»¥ä¸ºè´Ÿã€é‡è¿æ— æ³•æ¢å¤ç­‰é—®é¢˜
4. å®¢æˆ·ç«¯å¯ä»¥ä½œå¼Šï¼ˆä¿®æ”¹è´¹ç”¨ã€æ‰‹ç‰Œç­‰ï¼‰

**ç”¨æˆ·æå‡ºçš„æ­£ç¡®æ–¹æ¡ˆ**ï¼š
> "æ¸¸æˆçš„æœ¬ä½“åº”è¯¥æ˜¯åœ¨åç«¯é‡Œé¢ï¼Œç©å®¶èƒ½çœ‹åˆ°çš„ç‰Œå±€åº”è¯¥åªæ˜¯æ¸¸æˆæœ¬ä½“çš„æ˜ å°„ï¼Œè€Œä¸è¯¥ç›´æ¥æ¥æ“çºµæ¸¸æˆæœ¬ä½“"

è¿™æ˜¯æ ‡å‡†çš„**æƒå¨æœåŠ¡å™¨ï¼ˆAuthoritative Serverï¼‰**æ¶æ„ï¼Œæ˜¯å¤šäººæ¸¸æˆçš„æœ€ä½³å®è·µã€‚

**æ¶æ„å¯¹æ¯”**ï¼š

```
æ—§æ¶æ„ï¼ˆé”™è¯¯ï¼‰ï¼š
å‰ç«¯A â†â†’ æœåŠ¡å™¨ï¼ˆåªè½¬å‘ï¼‰ â†â†’ å‰ç«¯B
  â†“                              â†“
æ¸¸æˆé€»è¾‘A                      æ¸¸æˆé€»è¾‘B
ï¼ˆå„è‡ªè®¡ç®—ï¼‰                   ï¼ˆå„è‡ªè®¡ç®—ï¼‰
âŒ çŠ¶æ€ä¸ä¸€è‡´
âŒ å¯ä»¥ä½œå¼Š
âŒ é‡è¿å›°éš¾

æ–°æ¶æ„ï¼ˆæ­£ç¡®ï¼‰ï¼š
å‰ç«¯A â†â†’ æœåŠ¡å™¨ï¼ˆæ¸¸æˆå¼•æ“ï¼‰ â†â†’ å‰ç«¯B
  â†“           â†“                  â†“
æ˜¾ç¤ºå±‚     æ¸¸æˆæœ¬ä½“            æ˜¾ç¤ºå±‚
ï¼ˆåªæ˜¾ç¤ºï¼‰ ï¼ˆå”¯ä¸€çœŸç›¸ï¼‰        ï¼ˆåªæ˜¾ç¤ºï¼‰
âœ… çŠ¶æ€ä¸€è‡´
âœ… é˜²ä½œå¼Š
âœ… é‡è¿ç®€å•
```

**å®ç°æ–¹æ¡ˆ**ï¼š

1. **æœåŠ¡å™¨ç«¯æ¸¸æˆå¼•æ“** (`server/gameEngine.js`)
   - å®Œæ•´çš„æ¸¸æˆé€»è¾‘ï¼ˆä»å®¢æˆ·ç«¯è¿ç§»ï¼‰
   - å¡ç‰Œæ•°æ®åº“ï¼ˆ15å¼ å¡ç‰Œï¼‰
   - çŠ¶æ€ç®¡ç†å’ŒéªŒè¯
   - æ¯ä¸ªç©å®¶çœ‹åˆ°ä¸åŒçš„çŠ¶æ€ï¼ˆéšè—å¯¹æ‰‹æ‰‹ç‰Œï¼‰
   - æ ¸å¿ƒç±»ï¼š`GameEngine`
   - æ ¸å¿ƒæ–¹æ³•ï¼š
     * `handleChoosePlay()` - å¤„ç†é€‰æ‹©å‡ºç‰Œ
     * `handleChooseReforge()` - å¤„ç†é€‰æ‹©é‡é“¸
     * `handlePlayCard()` - éªŒè¯å¹¶æ‰§è¡Œæ‰“å‡ºå¡ç‰Œ
     * `handleExecuteReforge()` - æ‰§è¡Œé‡é“¸
     * `startNewRound()` - å¼€å§‹æ–°å›åˆ
     * `endGame()` - ç»“æŸæ¸¸æˆ
     * `getPlayerGameState()` - è·å–ç©å®¶ä¸“å±çŠ¶æ€ï¼ˆåŒ…å«è‡ªå·±çš„æ‰‹ç‰Œï¼‰

2. **æœåŠ¡å™¨ç«¯é›†æˆ** (`server/index.js`)
   - å¯¼å…¥ `GameEngine`
   - æ¸¸æˆå¼€å§‹æ—¶åˆ›å»ºæ¸¸æˆå¼•æ“å®ä¾‹
   - æ¥æ”¶ç©å®¶æ“ä½œè¯·æ±‚ï¼ˆä¸å†æ˜¯è½¬å‘ï¼‰
   - è°ƒç”¨æ¸¸æˆå¼•æ“éªŒè¯å’Œæ‰§è¡Œ
   - å¹¿æ’­æ›´æ–°åçš„çŠ¶æ€ç»™æ‰€æœ‰ç©å®¶
   - æ¯ä¸ªç©å®¶æ”¶åˆ°çš„çŠ¶æ€ä¸åŒï¼ˆè‡ªå·±èƒ½çœ‹åˆ°æ‰‹ç‰Œï¼Œå¯¹æ‰‹çœ‹ä¸åˆ°ï¼‰
   - é‡è¿æ—¶ç›´æ¥å‘é€å½“å‰æ¸¸æˆçŠ¶æ€

3. **å®¢æˆ·ç«¯æ¸¸æˆé€»è¾‘** (`src/composables/useGameClient.ts`)
   - ç®€åŒ–çš„å®¢æˆ·ç«¯é€»è¾‘
   - åªè´Ÿè´£UIçŠ¶æ€ï¼ˆé€‰ä¸­çš„å¡ç‰Œã€å¯ç”¨æ§½ä½ç­‰ï¼‰
   - ä¸æ‰§è¡Œæ¸¸æˆé€»è¾‘ï¼Œåªæ„é€ æ“ä½œè¯·æ±‚
   - æ¥æ”¶å¹¶æ˜¾ç¤ºæœåŠ¡å™¨è¿”å›çš„çŠ¶æ€
   - æ ¸å¿ƒæ–¹æ³•ï¼š
     * `updateGameState()` - æ›´æ–°æ¸¸æˆçŠ¶æ€
     * `choosePlay()` - è¿”å›å‡ºç‰Œè¯·æ±‚
     * `selectSlotToPlay()` - è¿”å›æ‰“ç‰Œè¯·æ±‚
     * `executeReforge()` - è¿”å›é‡é“¸è¯·æ±‚

4. **å®¢æˆ·ç«¯ç»„ä»¶é‡å†™** (`src/views/Game/CardGameMultiplayer.vue`)
   - ä½¿ç”¨ `useGameClient` æ›¿ä»£ `useGameMultiplayer`
   - ç›‘å¬ `gameStateUpdate` äº‹ä»¶
   - æ‰€æœ‰æ“ä½œæ”¹ä¸ºå‘é€è¯·æ±‚è€Œä¸æ˜¯æœ¬åœ°æ‰§è¡Œ
   - æœåŠ¡å™¨è¿”å›ç»“æœåè‡ªåŠ¨æ›´æ–°UI

5. **é€šä¿¡åè®®æ›´æ–°** (`src/composables/useMultiplayer.ts`)
   - æ·»åŠ  `gameStateUpdate` äº‹ä»¶ç›‘å¬
   - æ·»åŠ  `onGameStateUpdateCallback` å›è°ƒæœºåˆ¶
   - ä¿ç•™ `sendAction` å‘é€æ“ä½œè¯·æ±‚

**æ•°æ®æµ**ï¼š

```
ç©å®¶æ“ä½œæµç¨‹ï¼š
1. ç©å®¶ç‚¹å‡»"å‡ºç‰Œ"æŒ‰é’®
2. å®¢æˆ·ç«¯è°ƒç”¨ game.choosePlay()
3. è¿”å› { type: 'choosePlay' }
4. é€šè¿‡ multiplayer.sendAction() å‘é€åˆ°æœåŠ¡å™¨
5. æœåŠ¡å™¨è°ƒç”¨ gameEngine.handleChoosePlay(playerId)
6. æ¸¸æˆå¼•æ“éªŒè¯å¹¶æ›´æ–°çŠ¶æ€
7. æœåŠ¡å™¨å¹¿æ’­æ–°çŠ¶æ€ç»™æ‰€æœ‰ç©å®¶
8. å®¢æˆ·ç«¯æ”¶åˆ° gameStateUpdate äº‹ä»¶
9. è°ƒç”¨ game.updateGameState(newState)
10. UIè‡ªåŠ¨æ›´æ–°

é‡è¿æµç¨‹ï¼š
1. ç©å®¶åˆ·æ–°é¡µé¢
2. è¿æ¥æœåŠ¡å™¨ï¼Œå‘é€ rejoinRoom
3. æœåŠ¡å™¨æŸ¥æ‰¾æ¸¸æˆå¼•æ“
4. è°ƒç”¨ gameEngine.getPlayerGameState(playerId)
5. è¿”å›åŒ…å«è¯¥ç©å®¶æ‰‹ç‰Œçš„å®Œæ•´çŠ¶æ€
6. å®¢æˆ·ç«¯ç›´æ¥æ˜¾ç¤ºï¼Œæ¸¸æˆç»§ç»­
```

**ä¼˜åŠ¿**ï¼š

1. **å”¯ä¸€çœŸç›¸æº**ï¼šæ¸¸æˆçŠ¶æ€åªåœ¨æœåŠ¡å™¨ç»´æŠ¤ï¼Œä¸ä¼šä¸ä¸€è‡´
2. **é˜²ä½œå¼Š**ï¼šå®¢æˆ·ç«¯æ— æ³•ç¯¡æ”¹æ¸¸æˆçŠ¶æ€ã€è´¹ç”¨ã€æ‰‹ç‰Œ
3. **çŠ¶æ€åŒæ­¥ç®€å•**ï¼šæœåŠ¡å™¨å¹¿æ’­çŠ¶æ€ï¼Œå®¢æˆ·ç«¯ç›´æ¥æ˜¾ç¤º
4. **é‡è¿å®¹æ˜“**ï¼šæœåŠ¡å™¨ä¿å­˜å®Œæ•´çŠ¶æ€ï¼Œé‡è¿ç›´æ¥å‘é€
5. **æ˜“äºè°ƒè¯•**ï¼šæ‰€æœ‰æ¸¸æˆé€»è¾‘åœ¨æœåŠ¡å™¨ï¼Œæ—¥å¿—æ¸…æ™°
6. **æ˜“äºæ‰©å±•**ï¼šæ·»åŠ æ–°åŠŸèƒ½åªéœ€ä¿®æ”¹æœåŠ¡å™¨ç«¯

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- âœ… `server/gameEngine.js` - æ–°å»ºï¼Œå®Œæ•´æ¸¸æˆå¼•æ“
- âœ… `server/index.js` - é›†æˆæ¸¸æˆå¼•æ“ï¼Œå¤„ç†æ“ä½œè¯·æ±‚
- âœ… `src/composables/useGameClient.ts` - æ–°å»ºï¼Œç®€åŒ–å®¢æˆ·ç«¯é€»è¾‘
- âœ… `src/composables/useMultiplayer.ts` - æ·»åŠ  gameStateUpdate æ”¯æŒ
- âœ… `src/views/Game/CardGameMultiplayer.vue` - å®Œå…¨é‡å†™ï¼Œä½¿ç”¨æ–°æ¶æ„
- ğŸ“¦ `src/views/Game/CardGameMultiplayer.vue.backup` - æ—§ç‰ˆæœ¬å¤‡ä»½

**æµ‹è¯•è¦ç‚¹**ï¼š
1. åˆ›å»ºæˆ¿é—´ï¼ŒåŒæ–¹åŠ å…¥
2. æ£€æŸ¥æ˜¯å¦èƒ½æ­£å¸¸å‡ºç‰Œ
3. æ£€æŸ¥è´¹ç”¨æ˜¯å¦æ­£ç¡®æ‰£é™¤ï¼ˆä¸èƒ½ä¸ºè´Ÿï¼‰
4. æ£€æŸ¥å¯¹æ‰‹çœ‹ä¸åˆ°æˆ‘çš„æ‰‹ç‰Œ
5. åˆ·æ–°é¡µé¢ï¼Œæ£€æŸ¥æ˜¯å¦èƒ½æ¢å¤æ¸¸æˆçŠ¶æ€
6. æ£€æŸ¥æ¸¸æˆé€»è¾‘æ˜¯å¦æ­£ç¡®ï¼ˆæˆ˜åŠ›è®¡ç®—ã€æ•ˆæœè§¦å‘ç­‰ï¼‰

**å·²çŸ¥é™åˆ¶**ï¼š
1. æˆ˜æœ¯ç‰Œçš„ç›®æ ‡é€‰æ‹©æš‚æœªå®ç°ï¼ˆéœ€è¦é¢å¤–çš„äº¤äº’ï¼‰
2. é¢å¤–æ§½ä½æ˜¾ç¤ºéœ€è¦ä¼˜åŒ–
3. éœ€è¦ä½¿ç”¨ä¸åŒæµè§ˆå™¨æµ‹è¯•ï¼ˆé¿å… localStorage å…±äº«ï¼‰

**çŠ¶æ€**ï¼šå·²å®ç°ï¼Œå¾…æµ‹è¯•

---

## éƒ¨ç½²æŒ‡å—

### åœ¨çº¿è®¿é—®

- **æ¸¸æˆåœ°å€**: https://doylesama114.github.io/poker-game/
- **åç«¯æœåŠ¡**: ngrok ä¸´æ—¶éš§é“ï¼ˆéœ€è¦ä¸»æœºè¿è¡Œï¼‰

### æœ¬åœ°éƒ¨ç½²

```bash
# 1. å®‰è£…ä¾èµ–
pnpm install
cd server && npm install && cd ..

# 2. å¯åŠ¨åç«¯
cd server && node index.js

# 3. å¯åŠ¨å‰ç«¯ï¼ˆæ–°ç»ˆç«¯ï¼‰
pnpm run dev
```

### GitHub Pages éƒ¨ç½²

é¡¹ç›®å·²é…ç½®è‡ªåŠ¨éƒ¨ç½²åˆ° GitHub Pagesï¼š

1. æ¨é€ä»£ç åˆ° GitHub
2. GitHub Actions è‡ªåŠ¨æ„å»ºå’Œéƒ¨ç½²
3. è®¿é—® `https://ä½ çš„ç”¨æˆ·å.github.io/poker-game/`

### ngrok åç«¯é…ç½®

ç”¨äºäº’è”ç½‘è”æœºï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰ï¼š

```bash
# 1. å®‰è£… ngrok
# è®¿é—® https://ngrok.com/ ä¸‹è½½

# 2. é…ç½® authtoken
ngrok config add-authtoken ä½ çš„token

# 3. å¯åŠ¨åç«¯éš§é“
ngrok http 3001

# 4. æ›´æ–°é…ç½®
# ä¿®æ”¹ src/config/multiplayer.ts ä¸­çš„ production åœ°å€
```

### æ°¸ä¹…éƒ¨ç½²æ–¹æ¡ˆ

æ¨èä½¿ç”¨ Render.com éƒ¨ç½²åç«¯ï¼ˆå…è´¹ï¼‰ï¼š
- è‡ªåŠ¨è·å¾—å›ºå®šåŸŸå
- æ”¯æŒ WebSocket
- æ— éœ€ä¿æŒæœ¬åœ°ç”µè„‘è¿è¡Œ

---

## å¼€å‘å†å²

### ç¬¬åäºŒé˜¶æ®µï¼šäº’è”ç½‘è”æœºéƒ¨ç½²ï¼ˆ2026å¹´2æœˆ12æ—¥ï¼‰

#### å®ç°1: GitHub Pages å‰ç«¯éƒ¨ç½²

**ç›®æ ‡**: è®©ä»»ä½•äººéƒ½èƒ½é€šè¿‡äº’è”ç½‘è®¿é—®æ¸¸æˆ

**å®ç°æ­¥éª¤**:
1. åˆ›å»º GitHub Actions è‡ªåŠ¨éƒ¨ç½²å·¥ä½œæµ
2. é…ç½® Vite æ„å»ºè·¯å¾„ï¼ˆbase: '/poker-game/'ï¼‰
3. ä¿®å¤è·¯ç”±é…ç½®ï¼ˆä½¿ç”¨ import.meta.env.BASE_URLï¼‰
4. æ·»åŠ  404.html å¤„ç† SPA è·¯ç”±
5. ä¿®å¤æ„å»ºè„šæœ¬ï¼ˆç§»é™¤ç±»å‹æ£€æŸ¥é¿å…å…¼å®¹æ€§é—®é¢˜ï¼‰

**é‡åˆ°çš„é—®é¢˜**:
- vue-tsc ç‰ˆæœ¬ä¸å…¼å®¹å¯¼è‡´æ„å»ºå¤±è´¥
- è·¯ç”± base è·¯å¾„é…ç½®é”™è¯¯å¯¼è‡´ç™½å±
- éœ€è¦æ·»åŠ  404.html å¤„ç† GitHub Pages çš„ SPA è·¯ç”±

**è§£å†³æ–¹æ¡ˆ**:
- å‡çº§ vue-tsc åˆ° 2.0.0
- ä¿®æ”¹ build è„šæœ¬è·³è¿‡ç±»å‹æ£€æŸ¥
- é…ç½®æ­£ç¡®çš„ base è·¯å¾„
- ä½¿ç”¨ import.meta.env.BASE_URL è‡ªåŠ¨é€‚é…

**ä¿®æ”¹æ–‡ä»¶**:
- `.github/workflows/deploy.yml` - æ–°å»ºï¼ŒGitHub Actions é…ç½®
- `vite.config.ts` - é…ç½® base è·¯å¾„å’Œæ„å»ºé€‰é¡¹
- `src/router/index.ts` - ä½¿ç”¨åŠ¨æ€ base è·¯å¾„
- `public/404.html` - æ–°å»ºï¼Œå¤„ç† SPA è·¯ç”±
- `package.json` - å‡çº§ä¾èµ–ï¼Œä¿®æ”¹æ„å»ºè„šæœ¬
- `DEPLOY_GUIDE.md` - æ–°å»ºï¼Œéƒ¨ç½²æŒ‡å—

**éƒ¨ç½²åœ°å€**: https://doylesama114.github.io/poker-game/

---

#### å®ç°2: ngrok åç«¯é…ç½®

**ç›®æ ‡**: è®©äº’è”ç½‘ç”¨æˆ·èƒ½è¿æ¥åˆ°æœ¬åœ°åç«¯æœåŠ¡å™¨

**å®ç°æ­¥éª¤**:
1. å®‰è£… ngrok
2. é…ç½® authtoken
3. å¯åŠ¨åç«¯éš§é“ï¼ˆngrok http 3001ï¼‰
4. æ›´æ–°å‰ç«¯é…ç½®è‡ªåŠ¨ä½¿ç”¨ ngrok åœ°å€

**é‡åˆ°çš„é—®é¢˜**:
- ngrok å…è´¹ç‰ˆåªèƒ½åŒæ—¶è¿è¡Œä¸€ä¸ªéš§é“
- å‰åç«¯éœ€è¦ä¸åŒçš„éš§é“åœ°å€
- æ¯æ¬¡é‡å¯ ngrok åœ°å€ä¼šå˜åŒ–

**è§£å†³æ–¹æ¡ˆ**:
- åªå¯åŠ¨åç«¯éš§é“ï¼Œå‰ç«¯éƒ¨ç½²åˆ° GitHub Pages
- é…ç½®å‰ç«¯ç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨ä½¿ç”¨ ngrok åç«¯åœ°å€
- åˆ›å»ºé…ç½®æ–‡ä»¶æ”¯æŒå¤šéš§é“ï¼ˆè™½ç„¶å…è´¹ç‰ˆæœ‰é™åˆ¶ï¼‰

**ä¿®æ”¹æ–‡ä»¶**:
- `src/config/multiplayer.ts` - æ·»åŠ  production é…ç½®ï¼Œè‡ªåŠ¨æ£€æµ‹ ngrok åŸŸå
- `ngrok-config.yml` - æ–°å»ºï¼Œngrok é…ç½®æ–‡ä»¶
- `start-ngrok.bat` - æ–°å»ºï¼Œå¿«é€Ÿå¯åŠ¨è„šæœ¬
- `NGROK_GUIDE.md` - æ–°å»ºï¼Œngrok é…ç½®æŒ‡å—

**é…ç½®ç¤ºä¾‹**:
```typescript
export const SERVER_CONFIG = {
  production: 'https://hildred-sufferable-karly.ngrok-free.dev',
  // ç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨ä½¿ç”¨æ­¤åœ°å€
}
```

---

#### å®ç°3: è‡ªåŠ¨åç«¯åœ°å€é…ç½®

**ç›®æ ‡**: ç”¨æˆ·è®¿é—® GitHub Pages æ—¶è‡ªåŠ¨è¿æ¥åˆ°æ­£ç¡®çš„åç«¯

**å®ç°é€»è¾‘**:
```typescript
export function getServerUrl(): string {
  // 1. ä¼˜å…ˆä½¿ç”¨ç”¨æˆ·æ‰‹åŠ¨é…ç½®
  const saved = getSavedServerUrl()
  if (saved) return saved
  
  // 2. ç”Ÿäº§ç¯å¢ƒä½¿ç”¨é…ç½®çš„åç«¯åœ°å€
  if (import.meta.env.PROD) {
    return SERVER_CONFIG.production
  }
  
  // 3. å¼€å‘ç¯å¢ƒä½¿ç”¨ localhost
  return 'http://localhost:3001'
}
```

**ä¼˜åŠ¿**:
- ç”¨æˆ·æ— éœ€æ‰‹åŠ¨é…ç½®æœåŠ¡å™¨åœ°å€
- å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨åˆ‡æ¢
- ä»æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰é…ç½®

**ä¿®æ”¹æ–‡ä»¶**:
- `src/config/multiplayer.ts` - å®Œå–„è‡ªåŠ¨é…ç½®é€»è¾‘

---

#### æŠ€æœ¯è¦ç‚¹æ€»ç»“

**GitHub Pages éƒ¨ç½²çš„å…³é”®**:
1. æ­£ç¡®é…ç½® base è·¯å¾„ï¼ˆåŒ¹é…ä»“åº“åï¼‰
2. ä½¿ç”¨ GitHub Actions è‡ªåŠ¨åŒ–éƒ¨ç½²
3. æ·»åŠ  404.html å¤„ç† SPA è·¯ç”±
4. ç¡®ä¿æ„å»ºè„šæœ¬èƒ½åœ¨ CI ç¯å¢ƒè¿è¡Œ

**ngrok é…ç½®çš„å…³é”®**:
1. å…è´¹ç‰ˆé™åˆ¶ï¼šåŒæ—¶åªèƒ½è¿è¡Œä¸€ä¸ªéš§é“
2. åœ°å€ä¼šå˜åŒ–ï¼šæ¯æ¬¡é‡å¯éœ€è¦æ›´æ–°é…ç½®
3. éœ€è¦ authtokenï¼šä»å®˜ç½‘è·å–
4. æ”¯æŒ HTTPSï¼šè‡ªåŠ¨æä¾› SSL è¯ä¹¦

**è‡ªåŠ¨é…ç½®çš„å…³é”®**:
1. åŒºåˆ†å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒ
2. ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å›ºå®šçš„åç«¯åœ°å€
3. æ”¯æŒç”¨æˆ·æ‰‹åŠ¨è¦†ç›–é…ç½®
4. è‡ªåŠ¨æ£€æµ‹è®¿é—®åŸŸå

---

#### ä½¿ç”¨æµç¨‹

**ä¸»æœºç«¯ï¼ˆä½ ï¼‰**:
1. å¯åŠ¨æœ¬åœ°åç«¯ï¼š`cd server && node index.js`
2. å¯åŠ¨ ngrok éš§é“ï¼š`ngrok http 3001`
3. è®°å½• ngrok åœ°å€ï¼ˆå¦‚æœå˜åŒ–ï¼Œéœ€è¦æ›´æ–°é…ç½®å¹¶é‡æ–°éƒ¨ç½²ï¼‰
4. è®¿é—® GitHub Pages åˆ›å»ºæˆ¿é—´
5. åˆ†äº«æˆ¿é—´IDç»™æœ‹å‹

**å®¢æˆ·ç«¯ï¼ˆæœ‹å‹ï¼‰**:
1. è®¿é—®ï¼šhttps://doylesama114.github.io/poker-game/
2. ç‚¹å‡»"è”æœºå¯¹æˆ˜"
3. è¾“å…¥æˆ¿é—´IDåŠ å…¥
4. å¼€å§‹æ¸¸æˆï¼

---

#### å·²çŸ¥é™åˆ¶

1. **ngrok åœ°å€ä¼šå˜åŒ–**ï¼š
   - å…è´¹ç‰ˆæ¯æ¬¡é‡å¯åœ°å€ä¸åŒ
   - éœ€è¦æ›´æ–°é…ç½®å¹¶é‡æ–°éƒ¨ç½²
   - è§£å†³æ–¹æ¡ˆï¼šå‡çº§ ngrok ä»˜è´¹ç‰ˆæˆ–éƒ¨ç½²åç«¯åˆ°äº‘æœåŠ¡å™¨

2. **éœ€è¦ä¿æŒç”µè„‘è¿è¡Œ**ï¼š
   - åç«¯åœ¨æœ¬åœ°è¿è¡Œ
   - å…³æœºåæœ‹å‹æ— æ³•è¿æ¥
   - è§£å†³æ–¹æ¡ˆï¼šéƒ¨ç½²åç«¯åˆ° Render.comï¼ˆå…è´¹ï¼‰

3. **é¦–æ¬¡è®¿é—®éœ€è¦ç‚¹å‡» "Visit Site"**ï¼š
   - ngrok å…è´¹ç‰ˆçš„å®‰å…¨æç¤º
   - æ¯ä¸ªç”¨æˆ·é¦–æ¬¡è®¿é—®éƒ½éœ€è¦ç‚¹å‡»
   - æ— æ³•ç»•è¿‡

---

#### ä¸‹ä¸€æ­¥æ”¹è¿›

1. **éƒ¨ç½²åç«¯åˆ° Render**ï¼š
   - æ°¸ä¹…åœ¨çº¿ï¼Œæ— éœ€æœ¬åœ°è¿è¡Œ
   - å›ºå®šåŸŸåï¼Œæ— éœ€æ›´æ–°é…ç½®
   - å®Œå…¨å…è´¹

2. **æ·»åŠ è‡ªå®šä¹‰åŸŸå**ï¼š
   - æ›´ä¸“ä¸šçš„è®¿é—®åœ°å€
   - éœ€è¦è´­ä¹°åŸŸå

3. **æ·»åŠ  HTTPS æ”¯æŒ**ï¼š
   - GitHub Pages è‡ªåŠ¨æä¾›
   - åç«¯éœ€è¦é…ç½® SSL è¯ä¹¦

---

## å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
# å‰ç«¯ä¾èµ–
npm install

# åç«¯ä¾èµ–
cd server
npm install
cd ..
```

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# å¯åŠ¨åç«¯ï¼ˆæ–°ç»ˆç«¯ï¼‰
cd server
npm start

# å¯åŠ¨å‰ç«¯ï¼ˆæ–°ç»ˆç«¯ï¼‰
npm run dev
```

### æµ‹è¯•è”æœºåŠŸèƒ½

1. æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:5173`
2. æ‰“å¼€æ— ç—•çª—å£ï¼ˆCtrl+Shift+Nï¼‰è®¿é—® `http://localhost:5173`
3. çª—å£1: è”æœºå¯¹æˆ˜ â†’ åˆ›å»ºæˆ¿é—´
4. çª—å£2: è”æœºå¯¹æˆ˜ â†’ åŠ å…¥æˆ¿é—´
5. å¼€å§‹æ¸¸æˆï¼

---

## å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆå¿…é¡»ä½¿ç”¨æ— ç—•æ¨¡å¼æµ‹è¯•ï¼Ÿ
**A**: åŒä¸€æµè§ˆå™¨çš„æ ‡ç­¾é¡µä¼šå…±äº« localStorage å’Œéƒ¨åˆ† sessionStorageï¼Œå¯¼è‡´é…ç½®å†²çªã€‚æ— ç—•æ¨¡å¼æä¾›å®Œå…¨éš”ç¦»çš„ç¯å¢ƒã€‚

### Q: çœ‹ä¸åˆ°å¯¹æ‰‹çš„æ“ä½œæ€ä¹ˆåŠï¼Ÿ
**A**: 
1. ç¡®è®¤ä¸¤ä¸ªçª—å£éƒ½åˆ·æ–°äº†ï¼ˆCtrl+F5ï¼‰
2. æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
3. æŸ¥çœ‹æ˜¯å¦æœ‰ `[useGameMultiplayer] ä»æ•°æ®åº“è·å–å¡ç‰Œ` æ—¥å¿—
4. ç¡®è®¤æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ

### Q: å¦‚ä½•ä½¿ç”¨ Sakura FRPï¼Ÿ
**A**: 
1. å®‰è£… Sakura FRP å®¢æˆ·ç«¯
2. åˆ›å»ºéš§é“æ˜ å°„ 3001 ç«¯å£ï¼ˆåç«¯ï¼‰å’Œ 5173 ç«¯å£ï¼ˆå‰ç«¯ï¼‰
3. åœ¨æ¸¸æˆä¸­ç‚¹å‡»"é…ç½®æœåŠ¡å™¨"
4. è¾“å…¥ FRP æä¾›çš„åœ°å€
5. ä¿å­˜å¹¶é‡æ–°è¿æ¥

### Q: æ¸¸æˆå¡ä½äº†æ€ä¹ˆåŠï¼Ÿ
**A**: 
1. æ£€æŸ¥åŒæ–¹æ˜¯å¦éƒ½å®Œæˆäº†æ“ä½œ
2. æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—
3. å¦‚æœä¸€æ–¹æ–­çº¿ï¼Œç­‰å¾…30ç§’æˆ¿é—´ä¼šè‡ªåŠ¨æ¸…ç†
4. åˆ·æ–°é¡µé¢é‡æ–°å¼€å§‹

### Q: å¦‚ä½•æ·»åŠ æ–°å¡ç‰Œï¼Ÿ
**A**: 
1. åœ¨ `src/data/cards.ts` ä¸­æ·»åŠ å¡ç‰Œå®šä¹‰
2. ç¡®ä¿IDå”¯ä¸€ï¼ˆcard_016, card_017...ï¼‰
3. å®šä¹‰æ•ˆæœå’Œå…³é”®è¯
4. å¦‚éœ€æ–°æ•ˆæœç±»å‹ï¼Œåœ¨ `src/game/effectManager.ts` ä¸­å®ç°

---

## é¡¹ç›®çŠ¶æ€

âœ… **å·²å®Œæˆ**:
- å®Œæ•´çš„å¡ç‰Œç³»ç»Ÿï¼ˆ15å¼ å¡ç‰Œï¼‰
- å•æœºAIå¯¹æˆ˜
- è”æœºå¯¹æˆ˜ç³»ç»Ÿ
- æˆ¿é—´ç®¡ç†
- æ“ä½œåŒæ­¥
- æ–­çº¿é‡è¿
- å†…ç½‘ç©¿é€æ”¯æŒ
- æ‰€æœ‰å·²çŸ¥bugä¿®å¤

ğŸ¯ **å¯èƒ½çš„æ”¹è¿›**:
- æ”¯æŒ2-4äººæ¸¸æˆï¼ˆå½“å‰ä»…2äººï¼‰
- æ·»åŠ æ›´å¤šå¡ç‰Œ
- æ”¹è¿›AIç®—æ³•
- æ·»åŠ æ¸¸æˆå›æ”¾
- æ·»åŠ æ’è¡Œæ¦œ
- ä¼˜åŒ–UI/UX

---

## æŠ€æœ¯ç»†èŠ‚

### æ ‡ç­¾é¡µéš”ç¦»æœºåˆ¶

ä½¿ç”¨ sessionStorage ä¸ºæ¯ä¸ªæ ‡ç­¾é¡µç”Ÿæˆå”¯ä¸€IDï¼š
```typescript
function getTabId(): string {
  let tabId = sessionStorage.getItem('tabId')
  if (!tabId) {
    tabId = `tab_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`
    sessionStorage.setItem('tabId', tabId)
  }
  return tabId
}
```

æ¯ä¸ªæ ‡ç­¾é¡µç»´æŠ¤ç‹¬ç«‹çš„ socket å®ä¾‹å’Œæ¸¸æˆçŠ¶æ€ã€‚

### æ“ä½œåŒæ­¥æœºåˆ¶

æ‰€æœ‰æ¸¸æˆæ“ä½œé€šè¿‡ `GameAction` æ¥å£åŒæ­¥ï¼š
```typescript
interface GameAction {
  type: 'choosePlay' | 'chooseReforge' | 'playCard' | ...
  data?: any
}
```

æµç¨‹ï¼š
1. ç©å®¶æ‰§è¡Œæ“ä½œ â†’ è°ƒç”¨æ¸¸æˆé€»è¾‘å‡½æ•°
2. å‡½æ•°è¿”å› `GameAction` å¯¹è±¡
3. é€šè¿‡ `multiplayer.sendAction(action)` å‘é€
4. æœåŠ¡å™¨å¹¿æ’­ç»™æˆ¿é—´å†…å…¶ä»–ç©å®¶
5. å¯¹æ‰‹æ”¶åˆ° `opponentAction` äº‹ä»¶
6. è°ƒç”¨ `applyOpponentAction(action)` åº”ç”¨æ“ä½œ

### å¡ç‰Œæ•ˆæœè®¡ç®—

æ•ˆæœè®¡ç®—é¡ºåºï¼š
1. éƒ¨ç½²æ—¶æ•ˆæœï¼ˆonDeployï¼‰
2. å…¶ä»–å¡ç‰Œæ‰“å‡ºæ—¶æ•ˆæœï¼ˆonOtherPlayï¼‰
3. æŒç»­æ•ˆæœï¼ˆonFieldï¼‰
4. é‡æ–°è®¡ç®—æ‰€æœ‰å¡ç‰Œæˆ˜åŠ›

å åŠ æ•ˆæœä½¿ç”¨ `stackedBonus` å­—æ®µæŒä¹…åŒ–ï¼Œåœ¨æˆ˜åŠ›é‡ç®—æ—¶ä¿ç•™ã€‚

---

## ç»´æŠ¤è¯´æ˜

### æ·»åŠ æ–°åŠŸèƒ½

1. åœ¨å¯¹åº”çš„ composable ä¸­æ·»åŠ é€»è¾‘
2. å¦‚éœ€åŒæ­¥ï¼Œæ·»åŠ æ–°çš„ `GameAction` ç±»å‹
3. åœ¨ `applyOpponentAction` ä¸­å¤„ç†æ–°æ“ä½œ
4. æ›´æ–° UI ç»„ä»¶
5. æµ‹è¯•å•æœºå’Œè”æœºæ¨¡å¼

### è°ƒè¯•æŠ€å·§

1. ä½¿ç”¨æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹æ—¥å¿—
2. æ‰€æœ‰å…³é”®æ“ä½œéƒ½æœ‰ `[æ¨¡å—å]` å‰ç¼€çš„æ—¥å¿—
3. æœåŠ¡å™¨æ—¥å¿—æ˜¾ç¤ºæˆ¿é—´å’Œæ“ä½œä¿¡æ¯
4. ä½¿ç”¨ Vue DevTools æŸ¥çœ‹å“åº”å¼çŠ¶æ€

### æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨ `computed` è€Œä¸æ˜¯ `watch` è®¡ç®—æ´¾ç”ŸçŠ¶æ€
- é¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºæ–°å¯¹è±¡
- ä½¿ç”¨ `v-memo` ä¼˜åŒ–åˆ—è¡¨æ¸²æŸ“
- å‡å°‘ä¸å¿…è¦çš„æ—¥å¿—è¾“å‡ºï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

---

## è®¸å¯è¯

è§ LICENSE æ–‡ä»¶

---

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issue æˆ– Pull Requestã€‚

---

**æœ€åæ›´æ–°**: 2024å¹´ï¼ˆæ ¹æ®å®é™…æ—¥æœŸè°ƒæ•´ï¼‰
**ç‰ˆæœ¬**: 1.0.0
**çŠ¶æ€**: ç¨³å®šç‰ˆæœ¬ï¼Œæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆ
