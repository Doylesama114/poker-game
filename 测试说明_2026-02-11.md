# 游戏逻辑完整移植测试说明

## 完成时间
2026年2月11日

## 重构内容
完全重写了 `server/gameEngine.js`，将完整的游戏逻辑从客户端移植到服务器端。

## 主要改进

### 1. 使用正确的15张卡牌数据
- 辛勤的苦工（额外出牌）
- 驮用马（创建槽位+条件战力）
- 法师（魔法战术牌叠加）
- 见习冒险者（关键词计数）
- 矮人铁匠（武器/护甲加成）
- 野猪（条件战力变化）
- 民兵（保护效果）
- 战士（武器叠加）
- 狮鹫（创建槽位）
- 农田（务农单位加成）
- 橡木武器店（职业加成）
- 铁匠铺（组合加成）
- 金牌烤火鸡（战术牌）
- 生命药水（战术牌）
- 魔法飞弹（战术牌）

### 2. 完整的游戏逻辑
- ✅ 正确的牌组创建（15张卡，每张1张）
- ✅ 初始抽3张牌
- ✅ 每回合抽1张牌
- ✅ 出牌逻辑（费用验证、槽位选择）
- ✅ 重铸逻辑（gainCost, gainPower, redraw）
- ✅ 效果管理器（onDeploy, onField, onOtherPlay等）
- ✅ 战力计算
- ✅ 回合管理
- ✅ 游戏结束判定

### 3. 完整的效果管理器
从 `src/game/effectManager.ts` 完整移植，支持：
- 关键词检查
- 触发"其他卡牌打出时"的效果
- 特殊卡牌战力计算（见习冒险者、野猪、农田、铁匠铺）
- 橡木武器店加成
- 重新计算所有战力
- 目标选择

## 测试步骤

### 准备工作
1. 使用两个不同的浏览器（Firefox + Chrome）或两台设备
2. 清除浏览器数据：
   ```javascript
   localStorage.clear()
   sessionStorage.clear()
   ```

### 测试流程

#### 1. 基础功能测试
- [ ] 创建房间
- [ ] 加入房间
- [ ] 游戏开始后双方都能看到自己的3张手牌
- [ ] 手牌显示正确的卡牌名称（不是简化的测试数据）

#### 2. 出牌测试
- [ ] 选择"出牌"
- [ ] 点击手牌
- [ ] 选择槽位
- [ ] 卡牌正确部署到场上
- [ ] 费用正确扣除
- [ ] 对手能看到你打出的卡牌

#### 3. 重铸测试
- [ ] 选择"重铸"
- [ ] 选择两个重铸选项
- [ ] 恢复费用（+2）
- [ ] 增加战力（+1）
- [ ] 换牌（选择手牌后换牌）

#### 4. 卡牌效果测试

##### 辛勤的苦工
- [ ] 打出后可以立即再打出一张牌

##### 驮用马/狮鹫
- [ ] 打出后创建额外槽位
- [ ] 可以在额外槽位上部署单位

##### 法师
- [ ] 打出魔法战术牌后战力+2
- [ ] 效果可以叠加

##### 战士
- [ ] 打出武器卡牌后战力+1
- [ ] 效果可以叠加

##### 矮人铁匠
- [ ] 打出武器/护甲卡牌时，目标卡牌战力+2

##### 见习冒险者
- [ ] 场上每种不同关键词+1战力
- [ ] 战力随场上卡牌变化

##### 野猪
- [ ] 有猎人/农夫/冒险者时战力-2
- [ ] 有农田/森林时战力+2

##### 农田
- [ ] 在农田上部署务农单位时战力+1

##### 橡木武器店
- [ ] 战士/士兵/冒险者战力+3

##### 铁匠铺
- [ ] 同时拥有矮人铁匠、锻炉、板甲时战力+15

##### 战术牌
- [ ] 金牌烤火鸡：居民/冒险者+2战力
- [ ] 生命药水：职业者+2战力
- [ ] 魔法飞弹：对手费用-2

#### 5. 回合管理测试
- [ ] 每回合开始时抽1张牌
- [ ] 回合数正确递增
- [ ] 双方都能正常操作

#### 6. 游戏结束测试
- [ ] 填满6个槽位触发最后一回合
- [ ] 对手还能再进行一回合
- [ ] 游戏结束后正确计算战力
- [ ] 显示胜负结果

## 已知问题
无

## 服务器状态
- 前端: http://localhost:5173/
- 后端: 端口 3001
- 状态: ✅ 正常运行

## 下一步
等待用户测试反馈
